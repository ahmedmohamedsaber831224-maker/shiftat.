<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="build-version" content="202602272259">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#00e5ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ø´ÙŠÙØªØ§ØªÙŠ">
<meta name="mobile-web-app-capable" content="yes">
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" 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">
<!-- Open Graph / WhatsApp / Telegram preview card -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://shiftaty.github.io/shiftat/index.html">
<meta property="og:title" content="âš¡ SHIFTATY">
<meta property="og:description" content="ØªØªØ¨Ø¹ Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„Ùƒ ÙˆØ£Ø±Ø¨Ø§Ø­Ùƒ ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù† â€” Ù…Ø¬Ø§Ù†Ø§Ù‹">
<meta property="og:image" content="https://shiftaty.github.io/shiftat/icon-512.png">
<meta property="og:image:width" content="512">
<meta property="og:image:height" content="512">
<meta property="og:site_name" content="SHIFTATY">
<meta property="og:locale" content="ar_EG">
<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="âš¡ SHIFTATY">
<meta name="twitter:description" content="ØªØªØ¨Ø¹ Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„Ùƒ ÙˆØ£Ø±Ø¨Ø§Ø­Ùƒ ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù† â€” Ù…Ø¬Ø§Ù†Ø§Ù‹">
<meta name="twitter:image" content="https://shiftaty.github.io/shiftat/icon-512.png">
<title>âš¡ SHIFTATY</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#060b14; --s1:#0d1525; --s2:#111e33; --s3:#162440;
    --cyan:#00e5ff; --violet:#7c3aed; --green:#00e676;
    --orange:#ff6d00; --red:#ff1744; --yellow:#ffd600;
    --text:#e8f0fe; --muted:#546e7a; --border:rgba(0,229,255,0.08);
    --safe-top: env(safe-area-inset-top);
    --safe-bot: env(safe-area-inset-bottom);
  }
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
  html{height:100%;}
  body{
    font-family:'Cairo',sans-serif;background:var(--bg);color:var(--text);
    min-height:100vh;overflow-x:hidden;
    padding-top:var(--safe-top);
    padding-bottom:calc(70px + var(--safe-bot));
  }
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
  body::after{content:'';position:fixed;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(ellipse at 15% 20%,rgba(124,58,237,0.12) 0%,transparent 40%),radial-gradient(ellipse at 85% 80%,rgba(0,229,255,0.08) 0%,transparent 40%);pointer-events:none;z-index:0;}

  .wrap{max-width:480px;margin:0 auto;padding:16px 16px 0;position:relative;z-index:1;}

  /* â”€â”€ HEADER â”€â”€ */
  .header{padding:24px 0 20px;text-align:center;}
  .hbadge{display:inline-block;background:rgba(124,58,237,0.2);border:1px solid rgba(124,58,237,0.4);color:#a78bfa;font-size:.68rem;padding:3px 14px;border-radius:20px;letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;}
  .header h1{font-size:2.2rem;font-weight:900;letter-spacing:-1.5px;}
  .hc{color:var(--cyan);text-shadow:0 0 30px rgba(0,229,255,0.5);}
  .hw{color:var(--text);}
  .header p{color:var(--muted);margin-top:6px;font-size:.85rem;}

  /* â”€â”€ BOTTOM NAV â”€â”€ */
  .bnav{
    position:fixed;bottom:0;left:0;right:0;
    background:rgba(13,21,37,0.95);
    backdrop-filter:blur(20px);
    -webkit-backdrop-filter:blur(20px);
    border-top:1px solid var(--border);
    display:flex;
    padding-bottom:var(--safe-bot);
    z-index:100;
  }
  .bnav-btn{
    flex:1;padding:12px 4px 10px;border:none;background:transparent;
    color:var(--muted);font-family:'Cairo',sans-serif;font-size:.65rem;
    font-weight:700;cursor:pointer;transition:all .25s;
    display:flex;flex-direction:column;align-items:center;gap:3px;
    text-decoration:none;-webkit-appearance:none;appearance:none;
    outline:none;user-select:none;-webkit-user-select:none;
  }
  .bnav-btn .ico{font-size:1.3rem;transition:transform .25s;}
  .bnav-btn.on{color:var(--cyan);}
  .bnav-btn.on .ico{transform:scale(1.2);}
  .bnav-btn:active .ico{transform:scale(0.9);}

  /* â”€â”€ PANEL â”€â”€ */
  .panel{display:none;animation:fadeUp .3s ease;}
  .panel.on{display:block;}
  @keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

  /* â”€â”€ CARD â”€â”€ */
  .card{background:var(--s1);border:1px solid var(--border);border-radius:20px;padding:20px;margin-bottom:14px;}
  .ch{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;padding-bottom:12px;border-bottom:1px solid var(--border);}
  .ct{font-size:.92rem;font-weight:800;color:var(--cyan);display:flex;align-items:center;gap:7px;}

  /* â”€â”€ GRID â”€â”€ */
  .grid{display:grid;gap:12px;}
  .g2{grid-template-columns:1fr 1fr;}
  .g3{grid-template-columns:1fr 1fr 1fr;}

  /* â”€â”€ FIELD â”€â”€ */
  .field{display:flex;flex-direction:column;gap:6px;}
  .field label{font-size:.7rem;color:var(--muted);font-weight:700;letter-spacing:.8px;text-transform:uppercase;}
  .field input,.field select{background:var(--s2);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:13px 14px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.95rem;outline:none;transition:all .25s;width:100%;-webkit-appearance:none;}
  .field input:focus,.field select:focus{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(0,229,255,0.08);background:var(--s3);}
  .field select option{background:var(--s2);}
  .field input::placeholder{color:var(--muted);opacity:.6;}

  /* â”€â”€ BUTTONS â”€â”€ */
  .btn{padding:14px 20px;border:none;border-radius:13px;font-family:'Cairo',sans-serif;font-weight:800;font-size:.9rem;cursor:pointer;transition:all .25s;display:inline-flex;align-items:center;justify-content:center;gap:7px;-webkit-appearance:none;}
  .btn:active{transform:scale(0.97);}
  .btn-glow{background:linear-gradient(135deg,var(--violet),var(--cyan));color:#fff;width:100%;box-shadow:0 4px 20px rgba(124,58,237,0.3);}
  .btn-green{background:linear-gradient(135deg,#00897b,var(--green));color:#000;width:100%;box-shadow:0 4px 20px rgba(0,230,118,0.2);}
  .btn-red{background:rgba(255,23,68,0.1);color:var(--red);border:1px solid rgba(255,23,68,0.22);padding:8px 13px;font-size:.78rem;border-radius:10px;}
  .btn-out{background:transparent;border:1px solid var(--border);color:var(--muted);padding:9px 14px;font-size:.8rem;}
  .btn-out:hover{border-color:var(--cyan);color:var(--cyan);}
  .btn-pdf{background:linear-gradient(135deg,#b91c1c,var(--orange));color:#fff;width:100%;padding:15px;font-size:.95rem;}

  /* â”€â”€ PLACE ITEMS â”€â”€ */
  .place-item{display:flex;justify-content:space-between;align-items:center;background:var(--s2);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin-bottom:10px;}
  .pi-l{display:flex;align-items:center;gap:12px;}
  .pi-ico{width:42px;height:42px;background:linear-gradient(135deg,var(--violet),#0891b2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;}
  .pi-name{font-weight:800;font-size:.92rem;}
  .pi-meta{font-size:.72rem;color:var(--muted);margin-top:2px;}
  .pi-price{font-size:.88rem;font-weight:800;color:var(--cyan);}

  /* â”€â”€ SHIFT ITEMS â”€â”€ */
  .shift-item{background:var(--s2);border:1px solid var(--border);border-radius:16px;padding:12px 14px;margin-bottom:8px;position:relative;overflow:hidden;}
  .shift-item::before{content:'';position:absolute;right:0;top:0;bottom:0;width:3px;background:linear-gradient(180deg,var(--cyan),var(--violet));}
  .si-row1{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
  .si-place{font-weight:900;font-size:1rem;color:var(--text);}
  .si-date{font-size:.7rem;color:var(--muted);margin-top:2px;}
  .si-amount{font-size:1.1rem;font-weight:900;color:var(--green);white-space:nowrap;}
  .si-row2{display:flex;justify-content:space-between;align-items:center;margin-top:6px;gap:8px;}
  .si-tags{display:flex;gap:5px;flex-wrap:wrap;flex:1;}
  .si-actions{display:flex;gap:5px;flex-shrink:0;}
  .tag{padding:3px 10px;border-radius:20px;font-size:.68rem;font-weight:700;}
  .tc{background:rgba(0,229,255,0.1);color:var(--cyan);border:1px solid rgba(0,229,255,0.2);}
  .tv{background:rgba(124,58,237,0.1);color:#a78bfa;border:1px solid rgba(124,58,237,0.2);}
  .tg{background:rgba(0,230,118,0.1);color:var(--green);border:1px solid rgba(0,230,118,0.2);}
  .to{background:rgba(255,109,0,0.1);color:var(--orange);border:1px solid rgba(255,109,0,0.2);}
  .ty{background:rgba(255,214,0,0.1);color:var(--yellow);border:1px solid rgba(255,214,0,0.2);}

  /* â”€â”€ STATS â”€â”€ */
  .stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;}
  .stat-box{background:var(--s2);border:1px solid var(--border);border-radius:15px;padding:16px 10px;text-align:center;position:relative;overflow:hidden;}
  .stat-box::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;}
  .stat-box.c::after{background:var(--cyan);}
  .stat-box.v::after{background:var(--violet);}
  .stat-box.g::after{background:var(--green);}
  .stat-num{font-size:1.6rem;font-weight:900;line-height:1;margin-bottom:4px;}
  .stat-box.c .stat-num{color:var(--cyan);}
  .stat-box.v .stat-num{color:#a78bfa;}
  .stat-box.g .stat-num{color:var(--green);}
  .stat-lbl{font-size:.68rem;color:var(--muted);font-weight:600;}

  /* â”€â”€ SALARY â”€â”€ */
  .salary-card{background:linear-gradient(135deg,rgba(124,58,237,0.12),rgba(0,229,255,0.07));border:1px solid rgba(0,229,255,0.18);border-radius:20px;padding:22px;margin-bottom:16px;}
  .big-num{text-align:center;padding:10px 0 18px;}
  .bn-lbl{font-size:.78rem;color:var(--muted);margin-bottom:6px;}
  .bn-val{font-size:3.2rem;font-weight:900;background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1;}
  .bn-curr{font-size:.78rem;color:var(--muted);margin-top:4px;}
  .s-row{display:flex;justify-content:space-between;align-items:center;padding:11px 0;border-bottom:1px solid var(--border);font-size:.85rem;}
  .s-row:last-child{border:none;}
  .s-row .lbl{color:var(--muted);}
  .s-row .val{font-weight:800;}
  .s-row.stotal .lbl{color:var(--text);font-weight:800;}
  .s-row.stotal .val{color:var(--green);}
  .s-row.stax .val{color:var(--red);}
  .s-row.snet .lbl{color:var(--cyan);font-weight:800;}
  .s-row.snet .val{color:var(--cyan);font-size:1.3rem;font-weight:900;}

  /* â”€â”€ PER-PLACE CARD â”€â”€ */
  .pplace-card{background:var(--s2);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:12px;}
  .pplace-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
  .pplace-name{font-weight:800;font-size:.9rem;}
  .pplace-gross{font-size:1rem;font-weight:900;color:var(--green);}
  .pplace-body{padding-top:12px;border-top:1px solid var(--border);}
  .tax-inline{display:flex;align-items:center;gap:8px;background:var(--s3);border-radius:11px;padding:10px 13px;margin-top:10px;border:1px solid var(--border);}
  .tax-inline label{font-size:.74rem;color:var(--muted);font-weight:700;flex:1;}
  .tax-inline input{width:65px;background:var(--s1);border:1px solid var(--border);border-radius:9px;padding:8px 8px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.88rem;outline:none;text-align:center;}
  .tax-inline input:focus{border-color:var(--cyan);}
  .tax-inline span{color:var(--orange);font-weight:800;}
  .pplace-result{display:flex;justify-content:space-between;align-items:center;margin-top:10px;padding:11px 13px;background:rgba(0,229,255,0.04);border-radius:10px;border:1px solid rgba(0,229,255,0.1);}
  .pplace-result .rl{font-size:.74rem;color:var(--muted);}
  .pplace-result .rv{font-size:1rem;font-weight:900;color:var(--cyan);}

  /* â”€â”€ MISC â”€â”€ */
  .sec-title{font-size:.7rem;color:var(--muted);font-weight:700;letter-spacing:1.2px;text-transform:uppercase;margin-bottom:12px;padding-right:10px;border-right:3px solid var(--cyan);}
  .extra-box{background:rgba(0,229,255,0.03);border:1px dashed rgba(0,229,255,0.14);border-radius:14px;padding:16px;margin-top:13px;}
  .extra-head{font-size:.74rem;color:var(--cyan);font-weight:800;letter-spacing:.8px;text-transform:uppercase;margin-bottom:13px;}
  .div{height:1px;background:var(--border);margin:16px 0;}
  .filter-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;align-items:center;}
  .filter-row select,.filter-row input[type=month]{background:var(--s2);border:1px solid var(--border);border-radius:10px;padding:9px 12px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.8rem;outline:none;-webkit-appearance:none;flex:1;}
  .flbl{font-size:.8rem;color:var(--muted);white-space:nowrap;}
  .gtax-row{display:flex;align-items:center;gap:10px;background:var(--s3);border-radius:12px;padding:12px 14px;margin-bottom:14px;border:1px solid var(--border);}
  .gtax-row label{font-size:.78rem;color:var(--muted);font-weight:700;flex:1;}
  .gtax-row input{width:65px;background:var(--s1);border:1px solid var(--border);border-radius:9px;padding:8px 8px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.88rem;outline:none;text-align:center;}
  .gtax-row span{color:var(--orange);font-weight:800;}
  .vtoggle{display:flex;gap:6px;margin-bottom:14px;}
  .vtbtn{flex:1;padding:10px 6px;border:1px solid var(--border);background:transparent;border-radius:10px;color:var(--muted);font-family:'Cairo',sans-serif;font-size:.78rem;font-weight:700;cursor:pointer;transition:all .25s;}
  .vtbtn.on{background:linear-gradient(135deg,var(--violet),#0891b2);color:#fff;border-color:transparent;}
  .empty{text-align:center;padding:50px 20px;color:var(--muted);}
  .empty .ico{font-size:3rem;opacity:.35;margin-bottom:10px;}
  .empty p{font-size:.85rem;}

  /* Preview box */
  .preview-box{background:var(--s3);border-radius:12px;padding:12px 16px;margin-top:12px;border:1px solid rgba(0,229,255,0.12);display:none;}
  .preview-lbl{font-size:.72rem;color:var(--muted);margin-bottom:4px;}
  .preview-val{font-size:1.4rem;font-weight:900;color:var(--green);}

  /* Install banner */
  .install-banner{display:none;background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(0,229,255,0.1));border:1px solid rgba(0,229,255,0.2);border-radius:16px;padding:16px;margin-bottom:14px;flex-direction:column;gap:10px;}
  .install-banner p{font-size:.85rem;color:var(--text);}
  .install-banner.show{display:flex;}

  /* â”€â”€ EDIT MODAL â”€â”€ */
  .modal-overlay{position:fixed;inset:0;background:rgba(6,11,20,0.92);z-index:8000;display:none;align-items:center;justify-content:center;padding:20px;}
  .modal-overlay.show{display:flex;}
  .modal-box{background:var(--s1);border:1px solid rgba(0,229,255,0.2);border-radius:22px;padding:26px 22px;max-width:360px;width:100%;}
  .modal-title{font-size:1rem;font-weight:800;color:var(--cyan);margin-bottom:18px;text-align:center;}

  /* â”€â”€ ACTIVATION OVERLAY â”€â”€ */
  .act-overlay{position:fixed;inset:0;background:rgba(6,11,20,0.97);z-index:9999;display:none;align-items:flex-end;justify-content:center;padding:0;}
  .act-box{background:var(--s1);border:1px solid rgba(0,229,255,0.2);border-radius:24px 24px 0 0;padding:24px 20px 36px;max-width:480px;width:100%;text-align:center;}
  .act-icon{font-size:3rem;margin-bottom:14px;}
  .act-title{font-size:1.3rem;font-weight:900;color:var(--cyan);margin-bottom:6px;}
  .act-sub{font-size:.82rem;color:var(--muted);margin-bottom:20px;line-height:1.6;}
  .act-free-btn{background:rgba(0,229,255,0.08);border:1px solid rgba(0,229,255,0.2);color:var(--cyan);padding:13px;border-radius:13px;width:100%;font-family:'Cairo',sans-serif;font-weight:800;font-size:.9rem;cursor:pointer;margin-bottom:10px;}
  .act-pay-box{background:var(--s2);border-radius:16px;padding:16px;margin:16px 0;text-align:right;border:1px solid var(--border);}
  .act-pay-title{font-size:.78rem;color:var(--muted);margin-bottom:10px;font-weight:700;text-align:center;}
  .act-pay-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;font-size:.82rem;}
  .act-pay-row:last-child{margin-bottom:0;}
  .act-pay-ico{font-size:1rem;}
  .act-pay-num{font-weight:800;color:var(--text);direction:ltr;}
  .act-pay-label{color:var(--muted);font-size:.75rem;}
  .act-input{background:var(--s2);border:1px solid var(--border);border-radius:12px;padding:13px 14px;color:var(--text);font-family:'Cairo',sans-serif;font-size:.95rem;outline:none;width:100%;margin-bottom:10px;text-align:center;letter-spacing:2px;}
  .act-input:focus{border-color:var(--cyan);}
  .act-activate-btn{background:linear-gradient(135deg,var(--violet),var(--cyan));color:#fff;padding:14px;border-radius:13px;width:100%;border:none;font-family:'Cairo',sans-serif;font-weight:800;font-size:.95rem;cursor:pointer;}
  .act-err{color:var(--red);font-size:.8rem;margin-top:8px;display:none;}
  .act-price-badge{display:inline-block;background:linear-gradient(135deg,var(--violet),var(--cyan));color:#fff;padding:6px 20px;border-radius:20px;font-size:1rem;font-weight:900;margin-bottom:16px;}

  /* â”€â”€ ADMIN PANEL â”€â”€ */
  .admin-overlay{position:fixed;inset:0;background:rgba(6,11,20,0.98);z-index:10000;display:none;align-items:center;justify-content:center;padding:20px;}
  .admin-overlay.show{display:flex;}
  .admin-box{background:var(--s1);border:1px solid rgba(124,58,237,0.3);border-radius:24px;padding:28px 22px;max-width:380px;width:100%;}
  .admin-title{font-size:1.1rem;font-weight:900;color:#a78bfa;margin-bottom:18px;text-align:center;}
  .admin-codes{background:var(--s2);border-radius:14px;padding:14px;max-height:200px;overflow-y:auto;margin-bottom:14px;}
  .code-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:.82rem;}
  .code-row:last-child{border:none;}
  .code-val{font-family:monospace;color:var(--cyan);font-weight:700;letter-spacing:1px;}
  .code-used{color:var(--red);font-size:.72rem;}
  .code-ok{color:var(--green);font-size:.72rem;}

  /* Responsive */
  @media (min-width:600px){
    .wrap{max-width:480px;margin:0 auto;}
    .bnav{max-width:480px;left:50%;transform:translateX(-50%);border-radius:20px 20px 0 0;}
  }
  @media (min-width:900px){
    .wrap{max-width:520px;}
    .bnav{max-width:520px;}
  }
  @media (max-width:360px){
    .bnav-btn{font-size:.58rem;padding:10px 2px 8px;}
    .field input,.field select{font-size:.88rem;padding:11px 12px;}
  }
  @media print {
    @page { margin: 10mm; }
    body{background:#fff!important;color:#000!important;padding:0!important;font-size:11px!important;}
    body::before,body::after{display:none!important;}
    .bnav,.btn,.filter-row,.vtoggle,.install-banner,#install-row,#ios-instructions{display:none!important;}
    .panel{display:block!important;}
    #panel-summary{display:block!important;}
    #panel-places,#panel-log,#panel-shifts{display:none!important;}
    *{color:#000!important;-webkit-text-fill-color:#000!important;text-shadow:none!important;box-shadow:none!important;}
    .card,.salary-card,.pplace-card,.stat-box{border:1px solid #ccc!important;background:#f9f9f9!important;margin-bottom:6px!important;padding:8px!important;break-inside:avoid;}
    .print-hdr{display:block!important;}
    /* ØªØµØºÙŠØ± Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */
    .pplace-card{margin-bottom:5px!important;padding:8px 10px!important;}
    .pplace-head{margin-bottom:4px!important;}
    .pplace-body{padding-top:6px!important;}
    .salary-card{padding:10px!important;}
    .s-row{padding:4px 0!important;}
    .stat-grid{gap:6px!important;margin-bottom:8px!important;}
    .stat-box{padding:8px!important;}
    .stat-num{font-size:1.3rem!important;}
    /* ØªØµØºÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
    .pplace-name{font-size:.8rem!important;}
    .pplace-gross{font-size:.85rem!important;}
    .tag{font-size:.65rem!important;padding:2px 6px!important;}
    .bn-val{font-size:1.6rem!important;}
    .lbl,.val{font-size:.78rem!important;}
    /* Ù…Ù†Ø¹ Ù‚Ø·Ø¹ Ø§Ù„ÙƒØ§Ø±Ø¯ Ø¹Ù„Ù‰ ØµÙØ­ØªÙŠÙ† */
    .pplace-card, .salary-card{page-break-inside:avoid;}
    .vtoggle{display:none!important;}
    #view-byplace{display:block!important;}
    #view-total{display:block!important;}
  }
  .print-hdr{display:none;text-align:center;margin-bottom:16px;}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
      <div class="hbadge">âš¡ SHIFT TRACKER</div>
      <div id="lang-toggle" onclick="toggleLang()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.25);border-radius:20px;padding:4px 12px;cursor:pointer;font-size:.78rem;font-weight:700;color:#fff;display:flex;align-items:center;gap:6px;-webkit-user-select:none;user-select:none;">
        <span id="lang-icon">ğŸŒ</span><span id="lang-label">English</span>
      </div>
    </div>
    <h1 id="admin-trigger" style="cursor:pointer;-webkit-user-select:none;user-select:none;"><span class="hc" style="font-family:Arial Black,Arial;letter-spacing:2px;">SHIFTATY</span></h1>
    <p id="header-subtitle">ØªØªØ¨Ø¹ Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„Ùƒ ÙˆØ£Ø±Ø¨Ø§Ø­Ùƒ ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†</p>
    <div id="upgrade-banner" style="display:none;margin-top:12px;">
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:4px;">
        <a href="https://wa.me/201116631624?text=%D8%B9%D8%A7%D9%8A%D8%B2%20%D8%A3%D8%B4%D8%AA%D8%B1%D9%8A%20%D8%A7%D9%84%D9%86%D8%B3%D8%AE%D8%A9%20%D8%A7%D9%84%D9%83%D8%A7%D9%85%D9%84%D8%A9%20%D9%85%D9%86%20%D8%AA%D8%B7%D8%A8%D9%8A%D9%82%20%D8%B3%D8%AC%D9%84%20%D8%B4%D9%8A%D9%81%D8%AA%D8%A7%D8%AA%D9%8A%20%F0%9F%92%B0" target="_blank" style="background:linear-gradient(135deg,#25d366,#128c7e);color:#fff;border:none;padding:10px 18px;border-radius:25px;font-family:Cairo,sans-serif;font-weight:900;font-size:.82rem;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:6px;box-shadow:0 4px 15px rgba(37,211,102,0.4);">
          <span id="wa-btn-lbl">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ±Ù‚ÙŠØ©</span>
        </a>
        <button onclick="showUpgrade()" style="background:linear-gradient(135deg,#ff6d00,#ffd600);color:#000;border:none;padding:10px 18px;border-radius:25px;font-family:Cairo,sans-serif;font-weight:900;font-size:.82rem;cursor:pointer;box-shadow:0 4px 15px rgba(255,109,0,0.4);">
          <span id="code-btn-lbl">ğŸ”‘ Ø¹Ù†Ø¯ÙŠ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Install + Share Buttons -->
  <div id="install-row" style="display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap;">
    <button id="install-android-btn" onclick="handleInstall('android')" style="flex:1;min-width:70px;background:linear-gradient(135deg,#1a73e8,#00e5ff);border:none;color:#fff;padding:7px 8px;border-radius:10px;font-family:Cairo,sans-serif;font-weight:800;font-size:.72rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:4px;">
      ğŸ¤– Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯
    </button>
    <button id="install-ios-btn" onclick="showIosInstructions()" style="flex:1;min-width:70px;background:linear-gradient(135deg,#1c1c1e,#3a3a3c);border:1px solid rgba(255,255,255,0.15);color:#fff;padding:7px 8px;border-radius:10px;font-family:Cairo,sans-serif;font-weight:800;font-size:.72rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:4px;">
       iPhone
    </button>
    <button id="install-desktop-btn" onclick="handleInstall('desktop')" style="flex:1;min-width:70px;background:linear-gradient(135deg,#7c3aed,#00e5ff);border:none;color:#fff;padding:7px 8px;border-radius:10px;font-family:Cairo,sans-serif;font-weight:800;font-size:.72rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:4px;">
      ğŸ’» ÙƒÙ…Ø¨ÙŠÙˆØªØ±
    </button>
    <button onclick="shareApp()" style="flex:1;min-width:70px;background:linear-gradient(135deg,#00897b,#00e676);border:none;color:#fff;padding:7px 8px;border-radius:10px;font-family:Cairo,sans-serif;font-weight:800;font-size:.72rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:4px;">
      <span id="share-btn-lbl">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©</span>
    </button>
  </div>
  <!-- iOS Instructions -->
  <div id="ios-instructions" style="display:none;background:linear-gradient(135deg,rgba(0,0,0,0.95),rgba(30,30,30,0.98));border:1px solid rgba(0,229,255,0.3);border-radius:16px;padding:18px;margin-bottom:14px;text-align:center;">
    <div style="font-size:1rem;font-weight:800;color:var(--cyan);margin-bottom:10px;"> ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ iPhone / iPad</div>
    <div style="font-size:.85rem;color:var(--text);line-height:2;">
      1ï¸âƒ£ Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ <strong style="color:var(--cyan);">Safari</strong> (Ù…Ø´ Chrome)<br>
      2ï¸âƒ£ Ø§Ø¶ØºØ· <strong style="color:var(--cyan);">Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© â¬†ï¸</strong> ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©<br>
      3ï¸âƒ£ Ø§Ø®ØªØ± <strong style="color:var(--cyan);">"Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"</strong><br>
      4ï¸âƒ£ Ø§Ø¶ØºØ· <strong style="color:var(--cyan);">"Ø¥Ø¶Ø§ÙØ©"</strong> âœ…
    </div>
    <button onclick="document.getElementById('ios-instructions').style.display='none'" style="margin-top:12px;background:rgba(0,229,255,0.15);border:1px solid var(--cyan);color:var(--cyan);padding:8px 20px;border-radius:10px;font-family:Cairo,sans-serif;font-weight:700;cursor:pointer;">Ø­Ø³Ù†Ø§Ù‹ âœ“</button>
  </div>
  <!-- Legacy banners (hidden) -->
  <div class="install-banner" id="install-banner" style="display:none!important;"></div>
  <div class="install-banner" id="ios-banner" style="display:none!important;"></div>

  <!-- â•â• PLACES â•â• -->
  <div id="panel-places" class="panel on">
    <div class="card">
      <div class="ch"><span class="ct" id="add-place-title">ğŸ¥ Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§Ù† Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯</span></div>
      <div class="grid">
        <div class="field"><label id="lbl-place-name">Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†</label><input type="text" id="p-name" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù†ÙˆØ±"></div>
        <div class="grid g2">
          <div class="field">
            <label id="lbl-pay-type">Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±</label>
            <select id="p-type">
              <option value="hour" id="opt-hour-p">Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©</option>
              <option value="shift" id="opt-shift-p">Ø¨Ø§Ù„Ø´ÙŠÙØª</option>
              <option value="case" id="opt-case-p">Ø¨Ø§Ù„Ø­Ø§Ù„Ø©</option>
            </select>
          </div>
          <div class="field"><label id="lbl-price">Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡)</label><input type="number" id="p-price" placeholder="0" min="0"></div>
        </div>
      </div>
      <div style="margin-top:14px;"><button class="btn btn-glow" onclick="addPlace()" id="add-place-btn-lbl">ğŸ¥ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙƒØ§Ù†</button></div>
    </div>
    <div class="sec-title" id="places-sec-title" style="display:none">Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div>
    <div id="places-list"><div class="empty"><div class="ico">ğŸ¥</div><p id="no-places-lbl">Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ø£Ù…Ø§ÙƒÙ† Ø¨Ø¹Ø¯</p></div></div>
  </div>

  <!-- â•â• LOG â•â• -->
  <div id="panel-log" class="panel">
    <div class="card">
      <div class="ch"><span class="ct" id="shift-form-title">â• Ø´ÙŠÙØª Ø¬Ø¯ÙŠØ¯</span></div>
      <div class="grid g2">
        <div class="field">
          <label id="lbl-workplace">Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„</label>
          <select id="l-place" onchange="onPlaceChange()"><option value="" id="lbl-select-place">Ø§Ø®ØªØ±...</option></select>
        </div>
        <div class="field"><label id="lbl-date">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" id="l-date"></div>
      </div>
      <div id="l-no-place" style="color:var(--muted);font-size:.85rem;text-align:center;padding:22px 0;" id="lbl-choose-first">â¬†ï¸ Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† Ø¹Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹</div>
      <div id="l-fields" style="display:none;">
        <div class="div"></div>
        <div class="sec-title" id="lbl-pay-type-section">Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø± ÙˆØ§Ù„Ø³Ø¹Ø±</div>
        <div class="grid g3" style="margin-bottom:12px;">
          <div class="field">
            <label id="lbl-pay-per">Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±</label>
            <select id="l-pay-type" onchange="onPayTypeChange()">
              <option value="hour" id="opt-hour-l">Ø³Ø§Ø¹Ø©</option>
              <option value="shift" id="opt-shift-l">Ø´ÙŠÙØª</option>
              <option value="case" id="opt-case-l">Ø­Ø§Ù„Ø©</option>
            </select>
          </div>
          <div class="field"><label id="lbl-pay-price">Ø§Ù„Ø³Ø¹Ø±</label><input type="number" id="l-pay-price" placeholder="0" min="0" oninput="updatePreview()"></div>
          <div class="field"><label id="l-count-lbl">Ø§Ù„Ø¹Ø¯Ø¯</label><input type="number" id="l-count" placeholder="0" min="0" oninput="updatePreview()"></div>
        </div>
        <div class="extra-box">
          <div class="extra-head" id="extra-head-lbl">âš¡ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</div>
          <!-- ØµÙ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
          <div style="display:grid;grid-template-columns:1fr 80px 80px;gap:6px;align-items:end;margin-bottom:6px;">
            <div><div style="font-size:.6rem;color:var(--muted);margin-bottom:3px;" id="lbl-ex-label">Ø§Ù„ØªØ³Ù…ÙŠØ©</div>
              <input type="text" id="l-ex-hour-name" value="Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px 8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.75rem;outline:none;width:100%;box-sizing:border-box;"></div>
            <div><div style="font-size:.6rem;color:var(--muted);margin-bottom:3px;" id="lbl-ex-count">Ø§Ù„Ø¹Ø¯Ø¯</div>
              <input type="number" id="l-ex-hour-count" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
            <div><div style="font-size:.6rem;color:var(--muted);margin-bottom:3px;" id="lbl-ex-price">Ø§Ù„Ø³Ø¹Ø±</div>
              <input type="number" id="l-ex-hour-price" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
          </div>
          <!-- ØµÙ Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ© -->
          <div style="display:grid;grid-template-columns:1fr 80px 80px;gap:6px;align-items:end;margin-bottom:6px;">
            <div><input type="text" id="l-ex-case-name" value="Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ©" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px 8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.75rem;outline:none;width:100%;box-sizing:border-box;"></div>
            <div><input type="number" id="l-ex-case-count" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
            <div><input type="number" id="l-ex-case-price" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
          </div>
          <!-- ØµÙ ØªÙƒÙ†ÙŠÙƒ -->
          <div style="display:grid;grid-template-columns:1fr 80px 80px;gap:6px;align-items:end;margin-bottom:6px;">
            <div><input type="text" id="l-ex-tech-name" value="ØªÙƒÙ†ÙŠÙƒ" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px 8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.75rem;outline:none;width:100%;box-sizing:border-box;"></div>
            <div><input type="number" id="l-ex-tech-count" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
            <div><input type="number" id="l-ex-tech-price" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
          </div>
          <!-- ØµÙ Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰ -->
          <div style="display:grid;grid-template-columns:1fr 80px 80px;gap:6px;align-items:end;margin-bottom:6px;">
            <div><input type="text" id="l-ex-other-name" value="Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px 8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.75rem;outline:none;width:100%;box-sizing:border-box;"></div>
            <div><input type="number" id="l-ex-other-count" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
            <div><input type="number" id="l-ex-other-price" placeholder="0" min="0" oninput="updatePreview()" style="background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;"></div>
          </div>
          <!-- ØµÙÙˆÙ Ø¥Ø¶Ø§ÙÙŠØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© -->
          <div id="extra-custom-rows"></div>
          <!-- Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯ -->
          <button type="button" onclick="addExtraRow()" id="add-extra-lbl" style="width:100%;background:rgba(0,229,255,0.08);border:1px dashed var(--cyan);color:var(--cyan);padding:7px;border-radius:10px;font-family:Cairo,sans-serif;font-weight:700;font-size:.78rem;cursor:pointer;margin-top:4px;">
            â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¥Ø¶Ø§ÙÙŠ
          </button>
        </div>
        <div class="field" style="margin-top:12px;">
          <label id="lbl-notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
          <input type="text" id="l-note" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø©...">
        </div>
        <div class="preview-box" id="l-preview">
          <div class="preview-lbl" id="lbl-preview">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
          <div class="preview-val" id="l-preview-val">0 Ø¬</div>
        </div>
        <div style="margin-top:14px;"><button class="btn btn-green" onclick="saveShift()" id="save-shift-lbl">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø´ÙŠÙØª</button></div>
      </div>
    </div>
  </div>

  <!-- â•â• SHIFTS â•â• -->
  <div id="panel-shifts" class="panel">
    <div class="filter-row">
      <select id="f-place" onchange="renderShifts()"><option value="">ÙƒÙ„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†</option></select>
      <input type="month" id="f-month" onchange="renderShifts()">
      <button class="btn btn-out" onclick="clearFilters()">âœ•</button>
    </div>
    <div id="shifts-list"><div class="empty"><div class="ico">ğŸ“‹</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠÙØªØ§Øª Ø¨Ø¹Ø¯</p></div></div>
  </div>

  <!-- â•â• SUMMARY â•â• -->
  <div id="panel-summary" class="panel">
    <div class="print-hdr"><h2 id="lbl-report-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨</h2><p id="print-range"></p></div>
    <div style="background:var(--s2);border:1px solid var(--border);border-radius:14px;padding:12px;margin-bottom:12px;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
        <div>
          <div style="font-size:.62rem;color:var(--muted);font-weight:700;margin-bottom:4px;" id="lbl-from-date">ğŸ“… Ù…Ù† ØªØ§Ø±ÙŠØ®</div>
          <input type="date" id="s-date-from" onchange="renderSummary()" style="background:var(--s3);border:1px solid var(--border);border-radius:10px;padding:8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.78rem;outline:none;width:100%;box-sizing:border-box;">
        </div>
        <div>
          <div style="font-size:.62rem;color:var(--muted);font-weight:700;margin-bottom:4px;" id="lbl-to-date">ğŸ“… Ù„ØªØ§Ø±ÙŠØ®</div>
          <input type="date" id="s-date-to" onchange="renderSummary()" style="background:var(--s3);border:1px solid var(--border);border-radius:10px;padding:8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.78rem;outline:none;width:100%;box-sizing:border-box;">
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;">
        <div>
          <div style="font-size:.62rem;color:var(--muted);font-weight:700;margin-bottom:4px;" id="lbl-or-month">ğŸ—“ï¸ Ø£Ùˆ Ø§Ø®ØªØ± Ø´Ù‡Ø±</div>
          <input type="month" id="s-month" onchange="onMonthChange()" style="background:var(--s3);border:1px solid var(--border);border-radius:10px;padding:8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.78rem;outline:none;width:100%;box-sizing:border-box;">
        </div>
        <div style="padding-top:18px;">
          <button class="btn btn-out" onclick="clearSummaryFilter()" id="all-time-lbl" style="white-space:nowrap;padding:8px 12px;font-size:.78rem;">ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª</button>
        </div>
      </div>
    </div>
    <div class="stat-grid">
      <div class="stat-box c"><div class="stat-num" id="st-shifts">0</div><div class="stat-lbl" id="lbl-st-shifts">Ø´ÙŠÙØªØ§Øª</div></div>
      <div class="stat-box v"><div class="stat-num" id="st-hours">0</div><div class="stat-lbl" id="lbl-st-hours">Ø³Ø§Ø¹Ø§Øª</div></div>
      <div class="stat-box g"><div class="stat-num" id="st-cases">0</div><div class="stat-lbl" id="lbl-st-cases">Ø­Ø§Ù„Ø§Øª</div></div>
    </div>
    <div class="vtoggle">
      <button class="vtbtn on" id="vt-total" onclick="setView('total')">ğŸ“Š <span id="lbl-vt-total">Ø§Ù„ÙƒÙ„ÙŠ</span></button>
      <button class="vtbtn" id="vt-byplace" onclick="setView('byplace')">ğŸ¥ <span id="lbl-vt-byplace">Ù„ÙƒÙ„ Ù…ÙƒØ§Ù†</span></button>
    </div>
    <!-- Total -->
    <div id="view-total">
      <div class="gtax-row">
        <label id="lbl-tax-pct">ğŸ§¾ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</label>
        <input type="number" id="tax-pct" value="0" min="0" max="100" onchange="renderSummary()">
        <span>%</span>
      </div>
      <div class="salary-card">
        <div class="big-num">
          <div class="bn-lbl" id="lbl-net-salary">ØµØ§ÙÙŠ Ø§Ù„Ù…Ø±ØªØ¨</div>
          <div class="bn-val" id="net-salary">0</div>
          <div class="bn-curr" id="lbl-currency">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</div>
        </div>
        <div class="s-row"><span class="lbl" id="lbl-base-pay">ğŸ¥ Ø£Ø¬Ø± Ø£Ø³Ø§Ø³ÙŠ</span><span class="val" id="sal-base">0 Ø¬</span></div>
        <div class="s-row"><span class="lbl" id="lbl-extra-pay">âš¡ Ø¥Ø¶Ø§ÙÙŠ</span><span class="val" id="sal-extra">0 Ø¬</span></div>
        <div class="s-row stotal"><span class="lbl" id="lbl-gross">ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span class="val" id="sal-gross">0 Ø¬</span></div>
        <div class="s-row stax"><span class="lbl" id="lbl-tax-row">ğŸ§¾ Ø¶Ø±ÙŠØ¨Ø© (<span id="tax-pct-lbl">0</span>%)</span><span class="val" id="sal-tax">0 Ø¬</span></div>
        <div class="s-row snet"><span class="lbl" id="lbl-net-row">ğŸ’° Ø§Ù„ØµØ§ÙÙŠ</span><span class="val" id="sal-net">0 Ø¬</span></div>
      </div>
    </div>
    <!-- By place -->
    <div id="view-byplace" style="display:none;">
      <div style="background:var(--s2);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:14px;">
        <div style="font-size:.72rem;color:var(--cyan);font-weight:800;margin-bottom:10px;" id="lbl-bp-filter">ğŸ“… ÙÙ„ØªØ± Ù„ÙƒÙ„ Ù…ÙƒØ§Ù† Ø¹Ù„Ù‰ Ø­Ø¯Ù‡</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;">
          <div style="flex:1;min-width:120px;">
            <div style="font-size:.65rem;color:var(--muted);margin-bottom:4px;font-weight:700;" id="lbl-bp-from">Ù…Ù† ØªØ§Ø±ÙŠØ®</div>
            <input type="date" id="bp-date-from" onchange="renderByPlace()" style="background:var(--s3);border:1px solid var(--border);border-radius:10px;padding:9px 10px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;">
          </div>
          <div style="flex:1;min-width:120px;">
            <div style="font-size:.65rem;color:var(--muted);margin-bottom:4px;font-weight:700;" id="lbl-bp-to">Ù„ØªØ§Ø±ÙŠØ®</div>
            <input type="date" id="bp-date-to" onchange="renderByPlace()" style="background:var(--s3);border:1px solid var(--border);border-radius:10px;padding:9px 10px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;">
          </div>
        </div>
        <div style="display:flex;gap:8px;">
          <input type="month" id="bp-month" onchange="onBpMonthChange()" style="flex:1;background:var(--s3);border:1px solid var(--border);border-radius:10px;padding:9px 10px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;">
          <button class="btn btn-out" onclick="clearBpFilter()" id="lbl-bp-alltime" style="font-size:.75rem;padding:9px 12px;">ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª</button>
        </div>
      </div>
      <div id="byplace-list"></div>
      <div class="salary-card">
        <div class="s-row stotal"><span class="lbl" id="lbl-bp-gross">ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</span><span class="val" id="bp-gross">0 Ø¬</span></div>
        <div class="s-row stax"><span class="lbl" id="lbl-bp-tax">ğŸ§¾ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨</span><span class="val" id="bp-tax">0 Ø¬</span></div>
        <div class="s-row snet"><span class="lbl" id="lbl-bp-net">ğŸ’° Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„ÙƒÙ„ÙŠ</span><span class="val" id="bp-net">0 Ø¬</span></div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px;">
      <button class="btn btn-pdf" onclick="printReport()"><span id="print-btn-lbl">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</span></button>
      <button class="btn" onclick="exportPDF()" style="background:linear-gradient(135deg,#1a73e8,#00e5ff);color:#fff;width:100%;padding:15px;font-size:.95rem;"><span id="export-pdf-lbl">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</span></button>
    </div>
    <div style="height:10px;"></div>
  </div>

</div><!-- /wrap -->

<!-- EDIT SHIFT MODAL -->
<div class="modal-overlay" id="edit-shift-modal" style="align-items:flex-end;padding:0;">
  <div style="background:var(--s1);border-radius:24px 24px 0 0;padding:20px 18px 30px;width:100%;max-width:500px;margin:0 auto;border-top:1px solid rgba(0,229,255,0.2);max-height:90vh;display:flex;flex-direction:column;">
    <!-- Header Ø«Ø§Ø¨Øª -->
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;flex-shrink:0;">
      <div style="font-size:1rem;font-weight:800;color:var(--cyan);">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙŠÙØª</div>
      <button onclick="document.getElementById('edit-shift-modal').classList.remove('show')" style="background:rgba(255,255,255,0.08);border:none;color:var(--muted);width:32px;height:32px;border-radius:50%;font-size:1.1rem;cursor:pointer;">âœ•</button>
    </div>
    <input type="hidden" id="es-id">
    <!-- Ù…Ø­ØªÙˆÙ‰ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ± -->
    <div style="overflow-y:auto;flex:1;padding-bottom:8px;">
      <div class="grid g2" style="margin-bottom:8px;">
        <div class="field"><label>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„</label><select id="es-place"></select></div>
        <div class="field"><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" id="es-date"></div>
      </div>
      <div class="grid g2" style="margin-bottom:8px;">
        <div class="field"><label>Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±</label>
          <select id="es-pay-type">
            <option value="hour">Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©</option>
            <option value="shift">Ø¨Ø§Ù„Ø´ÙŠÙØª</option>
            <option value="case">Ø¨Ø§Ù„Ø­Ø§Ù„Ø©</option>
          </select>
        </div>
        <div class="field"><label>Ø§Ù„Ø³Ø¹Ø±</label><input type="number" id="es-pay-price" min="0"></div>
      </div>
      <div class="field" style="margin-bottom:8px;"><label>Ø§Ù„Ø¹Ø¯Ø¯</label><input type="number" id="es-count" min="0"></div>
      <div class="grid g2" style="margin-bottom:6px;">
        <div class="field"><label>Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label><input type="number" id="es-exHC" min="0"></div>
        <div class="field"><label>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</label><input type="number" id="es-exHP" min="0"></div>
      </div>
      <div class="grid g2" style="margin-bottom:6px;">
        <div class="field"><label>Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ©</label><input type="number" id="es-exCC" min="0"></div>
        <div class="field"><label>Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„Ø©</label><input type="number" id="es-exCP" min="0"></div>
      </div>
      <div class="grid g2" style="margin-bottom:6px;">
        <div class="field"><label>Ø­Ø§Ù„Ø§Øª ØªÙƒÙ†ÙŠÙƒ</label><input type="number" id="es-exTC" min="0"></div>
        <div class="field"><label>Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ†ÙŠÙƒ</label><input type="number" id="es-exTP" min="0"></div>
      </div>
      <div class="grid g2" style="margin-bottom:6px;">
        <div class="field"><label>Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰</label><input type="number" id="es-exOC" min="0"></div>
        <div class="field"><label>Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø®Ø±Ù‰</label><input type="number" id="es-exOP" min="0"></div>
      </div>
      <div class="field" style="margin-bottom:6px;"><label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><input type="text" id="es-note"></div>
    </div>
    <!-- Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ Ø«Ø§Ø¨Øª ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ -->
    <div style="flex-shrink:0;padding-top:12px;border-top:1px solid var(--border);">
      <button class="btn btn-green" onclick="saveEditShift()" style="width:100%;padding:16px;font-size:1rem;font-weight:900;letter-spacing:1px;border-radius:14px;">
        âœ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      </button>
    </div>
  </div>
</div>

<!-- EDIT PLACE MODAL -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal-box">
    <div class="modal-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„</div>
    <input type="hidden" id="edit-place-id">
    <div class="grid" style="margin-bottom:14px;">
      <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†</label><input type="text" id="edit-place-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†"></div>
      <div class="grid g2">
        <div class="field">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±</label>
          <select id="edit-place-type">
            <option value="hour">Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©</option>
            <option value="shift">Ø¨Ø§Ù„Ø´ÙŠÙØª</option>
            <option value="case">Ø¨Ø§Ù„Ø­Ø§Ù„Ø©</option>
          </select>
        </div>
        <div class="field"><label>Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡)</label><input type="number" id="edit-place-price" placeholder="0" min="0"></div>
      </div>
    </div>
    <div style="display:flex;gap:10px;">
      <button class="btn btn-green" style="flex:2;" onclick="saveEditPlace()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
      <button class="btn btn-out" style="flex:1;" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- ACTIVATION OVERLAY -->
<div class="act-overlay" id="act-overlay">
  <div class="act-box">
    <div class="act-icon">âš¡</div>
    <div class="act-title" style="font-family:Arial Black,Arial;letter-spacing:2px;">SHIFTATY</div>
    <div class="act-price-badge">100 Ø¬Ù†ÙŠÙ‡ ÙÙ‚Ø·</div>
    <div class="act-sub">âœ… Ù…Ø¬Ø§Ù†Ø§Ù‹: Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ + ØªØ³Ø¬ÙŠÙ„ Ø´ÙŠÙØªØ§Øª + Ù…Ù„Ø®Øµ ÙƒØ§Ù…Ù„<br>â­ Ù…Ø¯ÙÙˆØ¹ (100Ø¬): Ø£Ù…Ø§ÙƒÙ† ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</div>

    <a href="https://wa.me/201116631624?text=%D8%B9%D8%A7%D9%8A%D8%B2%20%D8%A3%D8%B4%D8%AA%D8%B1%D9%8A%20%D8%A7%D9%84%D9%86%D8%B3%D8%AE%D8%A9%20%D8%A7%D9%84%D9%83%D8%A7%D9%85%D9%84%D8%A9%20%D9%85%D9%86%20%D8%AA%D8%B7%D8%A8%D9%8A%D9%82%20%D8%B3%D8%AC%D9%84%20%D8%B4%D9%8A%D9%81%D8%AA%D8%A7%D8%AA%D9%8A%20%F0%9F%92%B0" target="_blank" style="display:block;background:linear-gradient(135deg,#25d366,#128c7e);color:#fff;border:none;padding:13px;border-radius:13px;font-family:Cairo,sans-serif;font-weight:800;font-size:.9rem;cursor:pointer;text-decoration:none;text-align:center;margin-bottom:10px;box-shadow:0 4px 20px rgba(37,211,102,0.3);">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ©</a>
    <button class="act-free-btn" onclick="useFree()">ğŸ†“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</button>

    <div class="act-pay-box">
      <div class="act-pay-title">ğŸ’³ Ù„Ù„ØªØ±Ù‚ÙŠØ© â€” Ø§Ø¯ÙØ¹ 100 Ø¬Ù†ÙŠÙ‡ (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·) Ø¹Ù„Ù‰:</div>
      <div class="act-pay-row"><span class="act-pay-ico">ğŸ“±</span><div><div class="act-pay-num">01158760466</div><div class="act-pay-label">InstaPay / Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´</div></div></div>
      <div class="act-pay-row"><span class="act-pay-ico">ğŸ“²</span><div><div class="act-pay-num">01116631624</div><div class="act-pay-label">Vodafone Cash</div></div></div>
      <div style="font-size:.75rem;color:var(--muted);margin-top:10px;text-align:center;">Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ Ù‡ØªØ§Ø®Ø¯ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</div>
    </div>

    <input class="act-input" id="act-code-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù‡Ù†Ø§" maxlength="20" 
      style="margin-bottom:12px;"
      onkeydown="if(event.key==='Enter'){event.preventDefault();tryActivate();}">
    <button class="act-activate-btn" type="button" onclick="tryActivate()" 
      style="position:sticky;bottom:0;z-index:10;">
      ğŸ”“ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
    </button>
    <div class="act-err" id="act-err">âŒ ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„</div>
  </div>
</div>

<!-- ADMIN OVERLAY -->
<div class="admin-overlay" id="admin-overlay">
  <div class="admin-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <div class="admin-title" style="margin:0;">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
      <button onclick="closeAdmin()" style="background:transparent;border:none;color:var(--muted);font-size:1.2rem;cursor:pointer;">âœ•</button>
    </div>
    <button class="btn btn-glow" style="margin-bottom:14px;" onclick="generateCode()">â• ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</button>
    <div id="new-code-display" style="display:none;background:var(--s3);border-radius:12px;padding:16px;text-align:center;margin-bottom:14px;border:1px solid rgba(0,229,255,0.25);">
      <div style="font-size:.72rem;color:var(--muted);margin-bottom:8px;">ğŸŸï¸ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ â€” Ø§Ø¨Ø¹ØªÙ‡ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</div>
      <div id="new-code-val" style="font-size:1.8rem;font-weight:900;color:var(--cyan);letter-spacing:5px;font-family:monospace;padding:10px;background:rgba(0,229,255,0.06);border-radius:10px;margin-bottom:10px;"></div>
      <button onclick="copyCode()" style="background:linear-gradient(135deg,var(--violet),var(--cyan));border:none;color:#fff;padding:10px 20px;border-radius:10px;font-family:Cairo,sans-serif;font-size:.85rem;font-weight:800;cursor:pointer;width:100%;margin-bottom:10px;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„</button>
      <a id="new-code-wa" href="#" target="_blank" style="display:block;background:linear-gradient(135deg,#25d366,#128c7e);color:#fff;border:none;padding:10px 20px;border-radius:10px;font-family:Cairo,sans-serif;font-size:.85rem;font-weight:800;cursor:pointer;text-decoration:none;margin-bottom:10px;">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©</button>
      <div id="new-code-copy-hint" style="font-size:.7rem;color:var(--orange);line-height:1.6;background:rgba(255,109,0,0.08);border-radius:8px;padding:8px;"></div>
    </div>
    <div style="font-size:.75rem;color:var(--muted);margin-bottom:8px;font-weight:700;">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</div>
    <div class="admin-codes" id="admin-codes-list"></div>
    <div style="font-size:.72rem;color:var(--muted);text-align:center;margin-top:10px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯: <span id="codes-count" style="color:var(--cyan);font-weight:800;">0</span></div>
  </div>
</div>

<!-- Bottom Nav -->
<nav class="bnav">
  <button class="bnav-btn on" type="button" onclick="event.preventDefault();event.stopPropagation();tab('places');return false;"><span class="ico">ğŸ¥</span><span id="nav-places-lbl">Ø§Ù„Ø£Ù…Ø§ÙƒÙ†</span></button>
  <button class="bnav-btn" type="button" onclick="event.preventDefault();event.stopPropagation();tab('log');return false;"><span class="ico">â•</span><span id="nav-shift-lbl">Ø´ÙŠÙØª</span></button>
  <button class="bnav-btn" type="button" onclick="event.preventDefault();event.stopPropagation();tab('shifts');return false;"><span class="ico">ğŸ“‹</span><span id="nav-log-lbl">Ø§Ù„Ø³Ø¬Ù„</span></button>
  <button class="bnav-btn" type="button" onclick="event.preventDefault();event.stopPropagation();tab('summary');return false;"><span class="ico">ğŸ’°</span><span id="nav-summary-lbl">Ø§Ù„Ù…Ù„Ø®Øµ</span></button>
</nav>

<script>
function openEditModal(id){
  const p=places.find(x=>x.id===id);
  if(!p)return;
  document.getElementById('edit-place-id').value=id;
  document.getElementById('edit-place-name').value=p.name;
  document.getElementById('edit-place-type').value=p.type;
  document.getElementById('edit-place-price').value=p.price;
  document.getElementById('edit-modal').classList.add('show');
}
function closeEditModal(){
  document.getElementById('edit-modal').classList.remove('show');
}
function saveEditPlace(){
  const id=parseInt(document.getElementById('edit-place-id').value);
  const name=document.getElementById('edit-place-name').value.trim();
  const type=document.getElementById('edit-place-type').value;
  const price=parseFloat(document.getElementById('edit-place-price').value)||0;
  if(!name){showToast('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†');return;}
  const idx=places.findIndex(x=>x.id===id);
  if(idx===-1)return;
  places[idx]={...places[idx],name,type,price};
  // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„Ø´ÙŠÙØªØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
  shifts=shifts.map(s=>s.placeId===id?{...s,placeName:name}:s);
  save();
  closeEditModal();
  renderPlaces();
  showToast('âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ '+name);
}

// â”€â”€ ACTIVATION SYSTEM â”€â”€
const ADMIN_PASS = 'ALL831224';
const FREE_LIMIT = 1;
const GAS_URL = 'https://script.google.com/macros/s/AKfycbz-vo0FCoiEJ7uw6tCeREs-3FyOREt5c3kIbVop-RuF06iNcfpCRiNzlkJIrzymEADQ/exec';

let isActivated = localStorage.getItem('sj_activated') === 'true';
let isFreeMode  = localStorage.getItem('sj_freemode')  === 'true';
let codesStore  = JSON.parse(localStorage.getItem('sj_codes') || '{}');
function saveCodes(){ localStorage.setItem('sj_codes', JSON.stringify(codesStore)); }

// ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± fetch Ù…Ø¹ no-cors fallback
function gasCall(params){
  const qs = Object.entries(params).map(function(kv){
    return kv[0]+'='+encodeURIComponent(kv[1]);
  }).join('&');
  const url = GAS_URL+'?'+qs;
  
  // Ù…Ø­Ø§ÙˆÙ„Ø© 1: fetch Ø¹Ø§Ø¯ÙŠ
  return fetch(url)
    .then(function(r){ return r.json(); })
    .catch(function(){
      // Ù…Ø­Ø§ÙˆÙ„Ø© 2: Script Tag Ù…Ø¹ callback
      return new Promise(function(resolve, reject){
        const cb = '_g' + Date.now() + Math.floor(Math.random()*9999);
        const timer = setTimeout(function(){
          cleanup(); reject(new Error('timeout'));
        }, 15000);
        function cleanup(){
          clearTimeout(timer);
          delete window[cb];
          const s = document.getElementById(cb);
          if(s) s.remove();
        }
        window[cb] = function(data){ cleanup(); resolve(data); };
        const script = document.createElement('script');
        script.id = cb;
        script.src = url+'&callback='+cb;
        script.onerror = function(){ cleanup(); reject(new Error('load_error')); };
        document.head.appendChild(script);
      });
    });
}

function checkActivation(){
  if(isActivated || isFreeMode){
    hideOverlay();
    document.getElementById('upgrade-banner').style.display = (isFreeMode && !isActivated) ? 'block' : 'none';
  } else {
    showOverlay();
  }
}

function showUpgrade(){
  showOverlay();
  setTimeout(function(){ document.getElementById('act-code-input').focus(); }, 300);
}

function useFree(){
  isFreeMode = true;
  isActivated = false;
  localStorage.setItem('sj_freemode','true');
  localStorage.removeItem('sj_activated');
  hideOverlay();
  document.getElementById('upgrade-banner').style.display = 'block';
  showToast('âœ… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© â€” Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ + Ø´ÙŠÙØªØ§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©');
}

function showOverlay(){
  const o = document.getElementById('act-overlay');
  o.style.display = 'flex';
}

function hideOverlay(){
  const o = document.getElementById('act-overlay');
  o.style.display = 'none';
}

async function tryActivate(){
  const code = document.getElementById('act-code-input').value.trim().toUpperCase();
  const err  = document.getElementById('act-err');
  const btn  = document.querySelector('.act-activate-btn');
  err.style.display='none';
  if(!code){ err.textContent='âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹'; err.style.display='block'; return; }

  btn.textContent='â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
  btn.disabled=true;

  try{
    const res = await gasCall({action:'verify', code:code});
    if(res.valid){
      try{ await gasCall({action:'use', code:code}); }catch(e){}
      isActivated=true; isFreeMode=false;
      localStorage.setItem('sj_activated','true');
      localStorage.removeItem('sj_freemode');
      hideOverlay();
      document.getElementById('upgrade-banner').style.display='none';
      showToast('ğŸ‰ ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©');
    } else {
      err.textContent = res.reason==='used' ? 'âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ù† Ù‚Ø¨Ù„' : 'âŒ ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­';
      err.style.display='block';
      document.getElementById('act-code-input').value='';
    }
  } catch(e){
    err.textContent='âš ï¸ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© ØªØ§Ù†ÙŠØ©';
    err.style.display='block';
  } finally{
    btn.textContent='ğŸ”“ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©';
    btn.disabled=false;
  }
}

function _activateSuccess(){
  isActivated=true; isFreeMode=false;
  localStorage.setItem('sj_activated','true');
  localStorage.removeItem('sj_freemode');
  hideOverlay();
  document.getElementById('upgrade-banner').style.display='none';
  showToast('ğŸ‰ ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©');
}

// tap counter ÙÙŠ DOMContentLoaded

function openAdmin(){
  renderAdminCodes();
  document.getElementById('admin-overlay').classList.add('show');
  document.getElementById('new-code-display').style.display='none';
}
function closeAdmin(){ document.getElementById('admin-overlay').classList.remove('show'); }

async function generateCode(){
  const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code='';
  for(let i=0;i<8;i++) code+=chars[Math.floor(Math.random()*chars.length)];
  const createdAt=new Date().toLocaleDateString('ar-EG');

  // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
  codesStore[code]={used:false,createdAt};
  saveCodes();

  // Ø±ÙØ¹ Ø¹Ù„Ù‰ GAS
  try{
    await gasCall({action:'add', code:code});
    showToast('âœ… Ø§Ù„ÙƒÙˆØ¯ '+code+' â€” Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… â˜ï¸');
  } catch(e){
    showToast('âœ… Ø§Ù„ÙƒÙˆØ¯ '+code+' â€” Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹');
  }

  // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯
  document.getElementById('new-code-val').textContent=code;
  document.getElementById('new-code-display').style.display='block';

  // Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ø¬Ø§Ù‡Ø²
  const msg=encodeURIComponent('Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‰\nÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ SHIFTATY:\n\n'+code+'\n\nØ§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ âœ…\n'+window.location.origin+window.location.pathname);
  document.getElementById('new-code-wa').href='https://wa.me/?text='+msg;

  renderAdminCodes();
}

function copyCode(){
  const code=document.getElementById('new-code-val').textContent;
  navigator.clipboard?.writeText(code).then(()=>showToast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯: '+code)).catch(()=>{});
}
function updateWaLink(code){
  const msg = encodeURIComponent('Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‰\nÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ SHIFTATY:\n' + code + '\n\nØ§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ âœ…');
  const el = document.getElementById('new-code-wa');
  if(el) el.href = 'https://wa.me/?text=' + msg;
}

function renderAdminCodes(){
  const el=document.getElementById('admin-codes-list');
  const entries=Object.entries(codesStore).reverse();
  document.getElementById('codes-count').textContent=entries.length;
  if(!entries.length){ el.innerHTML='<div style="color:var(--muted);font-size:.8rem;text-align:center;padding:10px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¹Ø¯</div>'; return; }
  el.innerHTML=entries.map(([code,info])=>`
    <div class="code-row">
      <span class="code-val">${code}</span>
      <div style="text-align:left;">
        ${info.used
          ? `<div class="code-used">âœ“ Ù…Ø³ØªØ®Ø¯Ù… â€” ${info.usedAt||''}</div>`
          : `<div class="code-ok">â— Ù…ØªØ§Ø­</div>`}
        <div style="font-size:.68rem;color:var(--muted);">${info.createdAt||''}</div>
      </div>
    </div>`).join('');
}

// â”€â”€ ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© â”€â”€
const _origAddPlace = typeof addPlace !== 'undefined' ? addPlace : null;


let places   = JSON.parse(localStorage.getItem('sj_places')||'[]');
let shifts   = JSON.parse(localStorage.getItem('sj_shifts') ||'[]');
let placeTax = JSON.parse(localStorage.getItem('sj_ptax')  ||'{}');
function save(){
  localStorage.setItem('sj_places',JSON.stringify(places));
  localStorage.setItem('sj_shifts', JSON.stringify(shifts));
  localStorage.setItem('sj_ptax',   JSON.stringify(placeTax));
}
const TYPE_LBL={hour:'Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©',shift:'Ø¨Ø§Ù„Ø´ÙŠÙØª',case:'Ø¨Ø§Ù„Ø­Ø§Ù„Ø©'};
let summaryView='total';
let deferredPrompt=null;

// â”€â”€ PWA Install â”€â”€
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();deferredPrompt=e;
  // ÙƒØ´Ù Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
  const isMobile = /android/i.test(navigator.userAgent);
  document.getElementById('install-row').style.display='flex';
  if(isMobile){
    document.getElementById('install-android-btn').style.display='flex';
  } else {
    document.getElementById('install-desktop-btn').style.display='flex';
  }
});
window.addEventListener('appinstalled',()=>{
  document.getElementById('install-banner').classList.remove('show');
  showToast('âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚!');
});
function installApp(){
  if(deferredPrompt){
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(()=>{ deferredPrompt=null; });
  }
}
function handleInstall(type){
  if(type==='android' || type==='desktop'){
    if(deferredPrompt){
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((result)=>{
        deferredPrompt = null;
        if(result.outcome === 'accepted'){
          // Ø§Ø®ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø¨ÙˆÙ„
          const row = document.getElementById('install-row');
          if(row) row.style.display = 'none';
          showToast('ğŸ‰ ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ù†Ø¬Ø§Ø­!');
        }
      });
    } else {
      showToast('ğŸ“² Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Chrome ÙˆØ§Ù†ØªØ¸Ø± Ø²Ø±Ø§Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª');
    }
  }
}
function shareApp(){
  const appUrl = 'https://shiftaty.github.io/shiftat/index.html';
  const title  = 'âš¡ SHIFTATY';
  const text   = 'shiftaty.github.io';
  if(navigator.share){
    navigator.share({ title: title, text: text, url: appUrl })
      .catch(()=>{});
  } else {
    navigator.clipboard?.writeText(appUrl).then(()=>{
      showToast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· â€” Ø´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø²Ù…Ù„Ø§Ø¦Ùƒ!');
    }).catch(()=>{ prompt('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·:', appUrl); });
  }
}

function showIosInstructions(){
  const el = document.getElementById('ios-instructions');
  el.style.display = el.style.display==='none' ? 'block' : 'none';
}

// â”€â”€ TABS â”€â”€
function tab(name){
  // Ù…Ù†Ø¹ Ø£ÙŠ Ø³Ù„ÙˆÙƒ Ø§ÙØªØ±Ø§Ø¶ÙŠ
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.bnav-btn').forEach(b=>b.classList.remove('on'));
  const panel = document.getElementById('panel-'+name);
  if(!panel) return;
  panel.classList.add('on');
  const idx=['places','log','shifts','summary'].indexOf(name);
  if(idx>-1) document.querySelectorAll('.bnav-btn')[idx].classList.add('on');
  if(name==='log'){populateSels();resetLog();}
  if(name==='shifts'){populateSels();renderShifts();}
  if(name==='summary'){renderSummary();}
  window.scrollTo({top:0,behavior:'smooth'});
  // Ù…Ù†Ø¹ scroll Ù„Ù„Ø£Ø¹Ù„Ù‰ ÙÙŠ URL
  if(history.pushState) history.pushState(null, null, window.location.pathname);
}

// â”€â”€ PLACES â”€â”€
function addPlace(){
  if(!isActivated && isFreeMode && places.length >= FREE_LIMIT){
    showToast(currentLang==='en'?'âš ï¸ Free version: one place only':'âš ï¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©: Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø´ÙŠÙØªØ§Øª ÙˆÙ…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ù„Ø®Øµ Ø¨Ø­Ø±ÙŠØ©');
    setTimeout(()=>{ showOverlay(); }, 1500);
    return;
  }
  const name=document.getElementById('p-name').value.trim();
  const type=document.getElementById('p-type').value;
  const price=parseFloat(document.getElementById('p-price').value)||0;
  if(!name){showToast(currentLang==='en'?'âš ï¸ Enter place name':'âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†');return;}
  places.push({id:Date.now(),name,type,price});
  save();
  document.getElementById('p-name').value='';
  document.getElementById('p-price').value='';
  renderPlaces();
  showToast((currentLang==='en'?'âœ… Added: ':'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ')+name);
}
function deletePlace(id){
  if(!confirm(currentLang==='en'?'Delete this place?':'Ù‡ØªØ­Ø°Ù Ø§Ù„Ù…ÙƒØ§Ù† Ø¯Ù‡ØŸ'))return;
  places=places.filter(p=>p.id!==id);shifts=shifts.filter(s=>s.placeId!==id);delete placeTax[id];
  save();renderPlaces();
}
function renderPlaces(){
  const isEn = currentLang === 'en';
  const TLBL = {hour: isEn?'Per Hour':'Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©', shift: isEn?'Per Shift':'Ø¨Ø§Ù„Ø´ÙŠÙØª', case: isEn?'Per Case':'Ø¨Ø§Ù„Ø­Ø§Ù„Ø©'};
  const el=document.getElementById('places-list');
  const secT=document.getElementById('places-sec-title');
  if(!places.length){
    if(secT) secT.style.display='none';
    el.innerHTML=`<div class="empty"><div class="ico">ğŸ¥</div><p>${isEn?'No places added yet':'Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ø£Ù…Ø§ÙƒÙ† Ø¨Ø¹Ø¯'}</p></div>`;
    return;
  }
  if(secT){ secT.style.display='block'; secT.textContent = isEn?'Registered Workplaces':'Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©'; }
  el.innerHTML=places.map(p=>`
    <div class="place-item">
      <div class="pi-l">
        <div class="pi-ico">ğŸ¥</div>
        <div><div class="pi-name">${p.name}</div><div class="pi-meta">${TLBL[p.type]} â€¢ ${p.price.toLocaleString()} ${isEn?'EGP':'Ø¬'}</div></div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <button class="btn btn-out" style="padding:7px 13px;font-size:.78rem;border-color:rgba(0,229,255,0.3);color:var(--cyan);" onclick="openEditModal(${p.id})">âœï¸ ${isEn?'Edit':'ØªØ¹Ø¯ÙŠÙ„'}</button>
        <button class="btn btn-red" onclick="deletePlace(${p.id})">ğŸ—‘ï¸</button>
      </div>
    </div>`).join('');
}

// â”€â”€ LOG â”€â”€
function populateSels(){
  const isEn = currentLang === 'en';
  ['l-place','f-place'].forEach(id=>{
    const sel=document.getElementById(id);if(!sel)return;
    const prev=sel.value,isF=id==='f-place';
    sel.innerHTML=isF?`<option value="">${isEn?'All Places':'ÙƒÙ„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†'}</option>`:`<option value="">${isEn?'Select...':'Ø§Ø®ØªØ±...'}</option>`;
    places.forEach(p=>{const o=document.createElement('option');o.value=p.id;o.textContent=p.name;sel.appendChild(o);});
    if(prev)sel.value=prev;
  });
}
function resetLog(){
  document.getElementById('l-place').value='';
  document.getElementById('l-fields').style.display='none';
  document.getElementById('l-no-place').style.display='block';
  document.getElementById('l-preview').style.display='none';
}
function onPlaceChange(){
  const pid=parseInt(document.getElementById('l-place').value);
  const p=places.find(x=>x.id===pid);
  if(!p){document.getElementById('l-fields').style.display='none';document.getElementById('l-no-place').style.display='block';return;}
  document.getElementById('l-fields').style.display='block';
  document.getElementById('l-no-place').style.display='none';
  document.getElementById('l-pay-type').value=p.type;
  document.getElementById('l-pay-price').value=p.price||'';
  onPayTypeChange();
}
function onPayTypeChange(){
  const isEn = currentLang === 'en';
  const t=document.getElementById('l-pay-type').value;
  const lbl=document.getElementById('l-count-lbl');
  if(t==='hour')     lbl.textContent = isEn ? 'Hours'  : 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª';
  else if(t==='shift')lbl.textContent = isEn ? 'Shifts' : 'Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙŠÙØªØ§Øª';
  else               lbl.textContent = isEn ? 'Cases'  : 'Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª';
}
function gv(id){const el=document.getElementById(id);if(!el)return 0;return parseFloat(el.value)||0;}

// Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¥Ø¶Ø§ÙÙŠ Ø¬Ø¯ÙŠØ¯
let extraRowCount = 0;
function addExtraRow(){
  extraRowCount++;
  const id = 'custom_' + extraRowCount;
  const div = document.createElement('div');
  div.id = 'extra-row-' + id;
  div.style.cssText = 'display:grid;grid-template-columns:1fr 80px 80px 30px;gap:6px;align-items:end;margin-bottom:6px;';
  
  const nameInput = document.createElement('input');
  nameInput.type='text'; nameInput.id='l-ex-'+id+'-name'; nameInput.placeholder='Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±';
  nameInput.style.cssText='background:var(--s3);border:1px solid var(--cyan);border-radius:8px;padding:6px 8px;color:var(--text);font-family:Cairo,sans-serif;font-size:.75rem;outline:none;width:100%;box-sizing:border-box;';
  
  const countInput = document.createElement('input');
  countInput.type='number'; countInput.id='l-ex-'+id+'-count'; countInput.placeholder='0'; countInput.min='0';
  countInput.oninput=updatePreview;
  countInput.style.cssText='background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;';
  
  const priceInput = document.createElement('input');
  priceInput.type='number'; priceInput.id='l-ex-'+id+'-price'; priceInput.placeholder='0'; priceInput.min='0';
  priceInput.oninput=updatePreview;
  priceInput.style.cssText='background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:6px;color:var(--text);font-family:Cairo,sans-serif;font-size:.8rem;outline:none;width:100%;box-sizing:border-box;text-align:center;';
  
  const delBtn = document.createElement('button');
  delBtn.type='button'; delBtn.textContent='âœ•';
  delBtn.style.cssText='background:rgba(239,68,68,0.15);border:1px solid #ef4444;color:#ef4444;border-radius:8px;padding:6px;cursor:pointer;font-size:.9rem;';
  delBtn.onclick=function(){ div.remove(); updatePreview(); };
  
  const d1=document.createElement('div'); d1.appendChild(nameInput);
  const d2=document.createElement('div'); d2.appendChild(countInput);
  const d3=document.createElement('div'); d3.appendChild(priceInput);
  div.appendChild(d1); div.appendChild(d2); div.appendChild(d3); div.appendChild(delBtn);
  document.getElementById('extra-custom-rows').appendChild(div);
}

function getCustomExtras(){
  const rows = document.querySelectorAll('[id^="extra-row-custom_"]');
  const result = [];
  rows.forEach(row => {
    const id = row.id.replace('extra-row-', '');
    const name = document.getElementById('l-ex-'+id+'-name')?.value || 'Ø¥Ø¶Ø§ÙÙŠ';
    const count = parseFloat(document.getElementById('l-ex-'+id+'-count')?.value)||0;
    const price = parseFloat(document.getElementById('l-ex-'+id+'-price')?.value)||0;
    if(count || price) result.push({name, count, price, total: count*price});
  });
  return result;
}
function updatePreview(){
  const base=gv('l-pay-price')*gv('l-count');
  const extra=gv('l-ex-hour-count')*gv('l-ex-hour-price')+gv('l-ex-case-count')*gv('l-ex-case-price')+gv('l-ex-tech-count')*gv('l-ex-tech-price')+gv('l-ex-other-count')*gv('l-ex-other-price');
  const customExtra = getCustomExtras().reduce((s,r)=>s+r.total,0);
  const total=base+extra+customExtra;
  const pv=document.getElementById('l-preview');
  if(total>0){pv.style.display='block';document.getElementById('l-preview-val').textContent=total.toLocaleString()+' Ø¬';}
  else pv.style.display='none';
}
function saveShift(){
  const pid=parseInt(document.getElementById('l-place').value);
  const p=places.find(x=>x.id===pid);
  if(!p){showToast(currentLang==='en'?'âš ï¸ Select a workplace':'âš ï¸ Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„');return;}
  const dateVal=document.getElementById('l-date').value;
  if(!dateVal){showToast(currentLang==='en'?'âš ï¸ Select a date':'âš ï¸ Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®');return;}
  const payType=document.getElementById('l-pay-type').value;
  const payPrice=gv('l-pay-price'),count=gv('l-count');
  const exHC=gv('l-ex-hour-count'),exHP=gv('l-ex-hour-price');
  const exCC=gv('l-ex-case-count'),exCP=gv('l-ex-case-price');
  const exTC=gv('l-ex-tech-count'),exTP=gv('l-ex-tech-price');
  const exOC=gv('l-ex-other-count'),exOP=gv('l-ex-other-price');
  const exHourName=document.getElementById('l-ex-hour-name')?.value||'Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©';
  const exCaseName=document.getElementById('l-ex-case-name')?.value||'Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ©';
  const exTechName=document.getElementById('l-ex-tech-name')?.value||'ØªÙƒÙ†ÙŠÙƒ';
  const exOtherName=document.getElementById('l-ex-other-name')?.value||'Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰';
  const customExtras=getCustomExtras();
  const note=document.getElementById('l-note').value.trim();
  const basePay=payPrice*count;
  const extraPay=exHC*exHP+exCC*exCP+exTC*exTP+exOC*exOP+customExtras.reduce((s,r)=>s+r.total,0);
  const total=basePay+extraPay;
  shifts.push({id:Date.now(),placeId:pid,placeName:p.name,date:dateVal,payType,payPrice,count,
    exHC,exHP,exHourName,exCC,exCP,exCaseName,exTC,exTP,exTechName,exOC,exOP,exOtherName,
    customExtras,extraPay,basePay,total,note});
  save();
  ['l-pay-price','l-count','l-ex-hour-count','l-ex-hour-price','l-ex-case-count','l-ex-case-price','l-ex-tech-count','l-ex-tech-price','l-ex-other-count','l-ex-other-price','l-note'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('extra-custom-rows').innerHTML='';
  extraRowCount=0;;
  document.getElementById('l-fields').style.display='none';
  document.getElementById('l-no-place').style.display='block';
  document.getElementById('l-preview').style.display='none';
  document.getElementById('l-place').value='';
  showToast((currentLang==='en'?'âœ… Saved! Total: ':'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸! Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ')+total.toLocaleString()+(currentLang==='en'?' EGP':' Ø¬'));
  tab('shifts');
}

// â”€â”€ SHIFTS LIST â”€â”€
function clearFilters(){document.getElementById('f-place').value='';document.getElementById('f-month').value='';renderShifts();}
function getFiltered(){
  let list=[...shifts];
  const fp=document.getElementById('f-place')?.value,fm=document.getElementById('f-month')?.value;
  if(fp)list=list.filter(s=>s.placeId==fp);
  if(fm)list=list.filter(s=>s.date.startsWith(fm));
  return list.sort((a,b)=>b.date.localeCompare(a.date));
}
function renderShifts(){
  const el=document.getElementById('shifts-list');
  const list=getFiltered();
  const isEn = currentLang === 'en';
  if(!list.length){el.innerHTML=`<div class="empty"><div class="ico">ğŸ“‹</div><p>${isEn?'No shifts yet':'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠÙØªØ§Øª Ø¨Ø¹Ø¯'}</p></div>`;return;}
  const PT={hour: isEn?'hr':'Ø³Ø§Ø¹Ø©', shift: isEn?'shift':'Ø´ÙŠÙØª', case: isEn?'case':'Ø­Ø§Ù„Ø©'};
  el.innerHTML=list.map(s=>{
    const tags=[];
    if(s.count)tags.push(`<span class="tag tc">â±ï¸ ${s.count} ${PT[s.payType]||''} Ã— ${s.payPrice}${isEn?' EGP':'Ø¬'}</span>`);
    if(s.exHC) tags.push(`<span class="tag tv">âš¡ ${s.exHC} ${s.exHourName||(isEn?'Extra Hours':'Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©')}</span>`);
    if(s.exCC) tags.push(`<span class="tag tg">ğŸ¥ ${s.exCC} ${s.exCaseName||(isEn?'Regular Cases':'Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ©')}</span>`);
    if(s.exTC) tags.push(`<span class="tag to">ğŸ”¬ ${s.exTC} ${s.exTechName||(isEn?'Technique':'ØªÙƒÙ†ÙŠÙƒ')}</span>`);
    if(s.exOC) tags.push(`<span class="tag ty">ğŸ”· ${s.exOC} ${s.exOtherName||(isEn?'Other Cases':'Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰')}</span>`);
    if(s.customExtras) s.customExtras.forEach(r=>{ if(r.count) tags.push(`<span class="tag ty">â• ${r.count} ${r.name}</span>`); });
    if(s.note) tags.push(`<span class="tag ty">ğŸ’¬ ${s.note}</span>`);
    return `<div class="shift-item">
      <div class="si-row1">
        <div>
          <div class="si-place">ğŸ¥ ${s.placeName}</div>
          <div class="si-date">ğŸ“… ${fmtDate(s.date)}</div>
        </div>
        <div class="si-actions">
          <button class="btn" style="background:rgba(0,229,255,0.15);border:1px solid var(--cyan);color:var(--cyan);padding:7px 12px;font-size:.85rem;" onclick="editShift(${s.id})">âœï¸</button>
          <button class="btn btn-red" style="padding:7px 12px;font-size:.85rem;" onclick="deleteShift(${s.id})">ğŸ—‘ï¸</button>
        </div>
      </div>
      <div class="si-row2">
        <div class="si-tags">${tags.join('')}</div>
        <div class="si-amount">${s.total.toLocaleString()} ${isEn?'EGP':'Ø¬'}</div>
      </div>
    </div>`;
  }).join('');
}
function deleteShift(id){if(!confirm(currentLang==='en'?'Delete this shift?':'Ù‡ØªØ­Ø°Ù Ø§Ù„Ø´ÙŠÙØª Ø¯Ù‡ØŸ'))return;shifts=shifts.filter(s=>s.id!==id);save();renderShifts();}

function editShift(id){
  const s=shifts.find(x=>x.id===id);
  if(!s)return;
  // Ù…Ù„Ø¡ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„
  const sel=document.getElementById('es-place');
  sel.innerHTML=places.map(p=>'<option value="'+p.id+'"'+(p.id===s.placeId?' selected':'')+'>'+p.name+'</option>').join('');
  // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  document.getElementById('es-id').value=id;
  document.getElementById('es-date').value=s.date;
  document.getElementById('es-pay-type').value=s.payType;
  document.getElementById('es-pay-price').value=s.payPrice||0;
  document.getElementById('es-count').value=s.count||0;
  document.getElementById('es-exHC').value=s.exHC||0;
  document.getElementById('es-exHP').value=s.exHP||0;
  document.getElementById('es-exCC').value=s.exCC||0;
  document.getElementById('es-exCP').value=s.exCP||0;
  document.getElementById('es-exTC').value=s.exTC||0;
  document.getElementById('es-exTP').value=s.exTP||0;
  document.getElementById('es-exOC').value=s.exOC||0;
  document.getElementById('es-exOP').value=s.exOP||0;
  document.getElementById('es-note').value=s.note||'';
  document.getElementById('edit-shift-modal').classList.add('show');
}

function saveEditShift(){
  const id=parseInt(document.getElementById('es-id').value);
  const idx=shifts.findIndex(x=>x.id===id);
  if(idx===-1)return;
  const pid=parseInt(document.getElementById('es-place').value);
  const p=places.find(x=>x.id===pid);
  if(!p){showToast('âš ï¸ Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„');return;}
  const payType=document.getElementById('es-pay-type').value;
  const payPrice=parseFloat(document.getElementById('es-pay-price').value)||0;
  const count=parseFloat(document.getElementById('es-count').value)||0;
  const exHC=parseFloat(document.getElementById('es-exHC').value)||0;
  const exHP=parseFloat(document.getElementById('es-exHP').value)||0;
  const exCC=parseFloat(document.getElementById('es-exCC').value)||0;
  const exCP=parseFloat(document.getElementById('es-exCP').value)||0;
  const exTC=parseFloat(document.getElementById('es-exTC').value)||0;
  const exTP=parseFloat(document.getElementById('es-exTP').value)||0;
  const exOC=parseFloat(document.getElementById('es-exOC').value)||0;
  const exOP=parseFloat(document.getElementById('es-exOP').value)||0;
  const note=document.getElementById('es-note').value.trim();
  const basePay=payPrice*count;
  const extraPay=exHC*exHP+exCC*exCP+exTC*exTP+exOC*exOP;
  const total=basePay+extraPay;
  shifts[idx]={...shifts[idx],placeId:pid,placeName:p.name,date:document.getElementById('es-date').value,payType,payPrice,count,exHC,exHP,exCC,exCP,exTC,exTP,exOC,exOP,extraPay,basePay,total,note};
  save();
  document.getElementById('edit-shift-modal').classList.remove('show');
  renderShifts();
  showToast((currentLang==='en'?'âœ… Updated! Total: ':'âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„! Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ')+total.toLocaleString()+(currentLang==='en'?' EGP':' Ø¬'));
}

// â”€â”€ SUMMARY â”€â”€
function setView(v){
  summaryView=v;
  document.getElementById('vt-total').classList.toggle('on',v==='total');
  document.getElementById('vt-byplace').classList.toggle('on',v==='byplace');
  document.getElementById('view-total').style.display=v==='total'?'block':'none';
  document.getElementById('view-byplace').style.display=v==='byplace'?'block':'none';
  renderSummary();
}
function onMonthChange(){
  // Ù„Ù…Ø§ ÙŠØ®ØªØ§Ø± Ø´Ù‡Ø± ÙŠÙ…Ø³Ø­ Ù…Ù†/Ù„ØªØ§Ø±ÙŠØ®
  document.getElementById('s-date-from').value='';
  document.getElementById('s-date-to').value='';
  renderSummary();
}
function clearSummaryFilter(){
  document.getElementById('s-month').value='';
  document.getElementById('s-date-from').value='';
  document.getElementById('s-date-to').value='';
  renderSummary();
}
function renderSummary(){
  const sm=document.getElementById('s-month').value;
  const sf=document.getElementById('s-date-from').value;
  const st=document.getElementById('s-date-to').value;
  let list=[...shifts];
  if(sm) list=list.filter(s=>s.date.startsWith(sm));
  else if(sf||st){
    list=list.filter(s=>{
      if(sf && s.date < sf) return false;
      if(st && s.date > st) return false;
      return true;
    });
  }
  document.getElementById('st-shifts').textContent=list.length;
  document.getElementById('st-hours').textContent=list.reduce((a,s)=>a+(s.payType==='hour'?s.count:0),0);
  document.getElementById('st-cases').textContent=list.reduce((a,s)=>a+(s.payType==='case'?s.count:0)+(s.exCC||0)+(s.exTC||0)+(s.exOC||0),0);
  const basePay=list.reduce((a,s)=>a+s.basePay,0);
  const extraPay=list.reduce((a,s)=>a+s.extraPay,0);
  const gross=basePay+extraPay;
  const taxPct=parseFloat(document.getElementById('tax-pct').value)||0;
  const taxAmt=gross*taxPct/100;
  const net=gross-taxAmt;
  const cu = currentLang==='en' ? ' EGP' : ' Ø¬';
  document.getElementById('sal-base').textContent=basePay.toLocaleString()+cu;
  document.getElementById('sal-extra').textContent=extraPay.toLocaleString()+cu;
  document.getElementById('sal-gross').textContent=gross.toLocaleString()+cu;
  document.getElementById('sal-tax').textContent='- '+taxAmt.toLocaleString()+cu;
  document.getElementById('sal-net').textContent=net.toLocaleString()+cu;
  document.getElementById('net-salary').textContent=net.toLocaleString();
  document.getElementById('tax-pct-lbl').textContent=taxPct;

  // by place â€” Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ù†ÙØµÙ„ Ø¹Ø´Ø§Ù† Ù„Ù‡ ÙÙ„ØªØ± Ù…Ø®ØªÙ„Ù
  renderByPlace();
}

function onBpMonthChange(){
  document.getElementById('bp-date-from').value='';
  document.getElementById('bp-date-to').value='';
  renderByPlace();
}

function clearBpFilter(){
  document.getElementById('bp-month').value='';
  document.getElementById('bp-date-from').value='';
  document.getElementById('bp-date-to').value='';
  renderByPlace();
}

function renderByPlace(){
  const bm = document.getElementById('bp-month')?.value || '';
  const bf = document.getElementById('bp-date-from')?.value || '';
  const bt = document.getElementById('bp-date-to')?.value || '';

  let list = [...shifts];
  if(bm) list = list.filter(s => s.date.startsWith(bm));
  else if(bf || bt){
    list = list.filter(s => {
      if(bf && s.date < bf) return false;
      if(bt && s.date > bt) return false;
      return true;
    });
  }

  const byPlace={};
  list.forEach(s=>{
    const k=s.placeId+'';
    if(!byPlace[k])byPlace[k]={name:s.placeName,placeId:s.placeId,base:0,extra:0,total:0,count:0};
    byPlace[k].base+=s.basePay;byPlace[k].extra+=s.extraPay;byPlace[k].total+=s.total;byPlace[k].count++;
  });

  const isEn = currentLang === 'en';
  const cu = isEn ? ' EGP' : ' Ø¬';
  const bpl=document.getElementById('byplace-list');
  if(!Object.keys(byPlace).length){
    bpl.innerHTML=`<div class="empty" style="padding:30px;"><p>${isEn?'No data for this period':'Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©'}</p></div>`;
    ['bp-gross','bp-tax','bp-net'].forEach(id=>document.getElementById(id).textContent='0'+cu);
    return;
  }
  let bpG=0,bpT=0;
  bpl.innerHTML=Object.entries(byPlace).map(([pid,d])=>{
    const st=placeTax[pid]||0,ta=d.total*st/100,pn=d.total-ta;
    bpG+=d.total;bpT+=ta;
    let periodLabel = '';
    if(bm) periodLabel = `<span class="tag tc" style="font-size:.62rem;">${bm}</span>`;
    else if(bf||bt) periodLabel = `<span class="tag tc" style="font-size:.62rem;">${bf||'...'} â† ${bt||'...'}</span>`;
    return `<div class="pplace-card">
      <div class="pplace-head">
        <div>
          <div class="pplace-name">ğŸ¥ ${d.name} <span class="tag tc">${d.count} ${isEn?'shifts':'Ø´ÙŠÙØª'}</span></div>
          <div style="margin-top:4px;">${periodLabel}</div>
        </div>
        <div class="pplace-gross">${d.total.toLocaleString()}${cu}</div>
      </div>
      <div class="pplace-body">
        <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:2px;">
          <span class="tag tv">${isEn?'Base':'Ø£Ø³Ø§Ø³ÙŠ'}: ${d.base.toLocaleString()}${cu}</span>
          <span class="tag to">${isEn?'Extra':'Ø¥Ø¶Ø§ÙÙŠ'}: ${d.extra.toLocaleString()}${cu}</span>
        </div>
        <div class="tax-inline"><label>ğŸ§¾ ${isEn?'Tax':'Ø¶Ø±ÙŠØ¨Ø©'} ${d.name}</label><input type="number" id="ptax-${pid}" value="${st}" min="0" max="100" onchange="updatePlaceTax('${pid}')"><span>%</span></div>
        <div class="pplace-result">
          <div>
            <div style="font-size:.68rem;color:var(--muted);">${isEn?'Deduct':'Ø®ØµÙ…'} (${st}%)</div>
            <div style="font-size:.85rem;font-weight:800;color:#ff6b6b;">- ${ta.toLocaleString()}${cu}</div>
          </div>
          <div style="text-align:${isEn?'right':'left'};">
            <div style="font-size:.68rem;color:var(--muted);">${isEn?'Net':'Ø§Ù„ØµØ§ÙÙŠ'}</div>
            <div style="font-size:1rem;font-weight:900;color:var(--cyan);" id="pnet-${pid}">${pn.toLocaleString()}${cu}</div>
          </div>
        </div>
      </div>
    </div>`;
  }).join('');
  document.getElementById('bp-gross').textContent=bpG.toLocaleString()+cu;
  document.getElementById('bp-tax').textContent='- '+bpT.toLocaleString()+cu;
  document.getElementById('bp-net').textContent=(bpG-bpT).toLocaleString()+cu;
}
function updatePlaceTax(pid){
  const val=parseFloat(document.getElementById('ptax-'+pid).value)||0;
  placeTax[pid]=val;save();
  renderByPlace();
}
function printReport(){
  _buildAndOpenReport(true);
}

function exportPDF(){
  _buildAndOpenReport(false);
}

function _buildAndOpenReport(autoPrint){
  const sm=document.getElementById('s-month').value;
  const sf=document.getElementById('s-date-from')?.value||'';
  const st=document.getElementById('s-date-to')?.value||'';
  let list=[...shifts];
  if(sm) list=list.filter(s=>s.date.startsWith(sm));
  else if(sf||st) list=list.filter(s=>{if(sf&&s.date<sf)return false;if(st&&s.date>st)return false;return true;});
  if(!list.length){showToast(currentLang==='en'?'âš ï¸ No data available':'âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');return;}

  const isEn = currentLang === 'en';
  const dir2 = isEn ? 'ltr' : 'rtl';

  // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø´ÙŠÙØªØ§Øª Ù„ÙƒÙ„ Ù…ÙƒØ§Ù†
  const byPlace={};
  const placeColors=['#1a73e8','#7c3aed','#00897b','#e65100','#c2185b','#0288d1','#558b2f','#6a1b9a'];
  let ci=0;
  list.forEach(s=>{
    const k=s.placeId+'';
    if(!byPlace[k]){byPlace[k]={name:s.placeName,shifts:[],total:0,base:0,extra:0,color:placeColors[ci%placeColors.length]};ci++;}
    byPlace[k].shifts.push(s);
    byPlace[k].total+=s.total;
    byPlace[k].base+=s.basePay;
    byPlace[k].extra+=s.extraPay;
  });

  const period = sm||((sf||(isEn?'Start':'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©'))+' â†’ '+(st||(isEn?'End':'Ø§Ù„Ù†Ù‡Ø§ÙŠØ©')));
  const taxPct = parseFloat(document.getElementById('tax-pct')?.value)||0;
  const grossTotal = list.reduce((a,s)=>a+s.total,0);
  const taxAmt = grossTotal*taxPct/100;
  const netTotal = grossTotal-taxAmt;

  // Ø¨Ù†Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†
  let placesHTML='';
  Object.entries(byPlace).forEach(([pid,d])=>{
    const color = d.color;
    const st2 = placeTax[pid]||0;
    const ta = d.total*st2/100;
    const pn = d.total-ta;
    const PT={hour:isEn?'hr':'Ø³Ø§Ø¹Ø©',shift:isEn?'shift':'Ø´ÙŠÙØª',case:isEn?'case':'Ø­Ø§Ù„Ø©'};

    const rows = d.shifts.map((s,i)=>{
      const det=[];
      if(s.count) det.push(`${s.count} ${PT[s.payType]||''} Ã— ${(s.payPrice||0).toLocaleString()} ${isEn?'EGP':'Ø¬'}`);
      if(s.exHC)  det.push(`âš¡ ${s.exHC} ${s.exHourName||'Ø¥Ø¶Ø§ÙÙŠ'}`);
      if(s.exCC)  det.push(`ğŸ©º ${s.exCC} ${s.exCaseName||'Ø¹Ø§Ø¯ÙŠØ©'}`);
      if(s.exTC)  det.push(`ğŸ”¬ ${s.exTC} ${s.exTechName||'ØªÙƒÙ†ÙŠÙƒ'}`);
      if(s.exOC)  det.push(`ğŸ”· ${s.exOC} ${s.exOtherName||'Ø£Ø®Ø±Ù‰'}`);
      if(s.customExtras) s.customExtras.forEach(r=>{if(r.count)det.push(`â• ${r.count} ${r.name}`);});
      const bg = i%2===0 ? '#fff' : '#f7f9ff';
      return `<tr style="background:${bg};">
        <td style="color:#333;font-size:.75rem;padding:7px 10px;border-bottom:1px solid #eef0f8;">${fmtDate(s.date)}</td>
        <td style="color:#444;font-size:.73rem;padding:7px 10px;border-bottom:1px solid #eef0f8;">${det.join(' Â· ')}</td>
        <td style="color:#1a73e8;font-weight:700;font-size:.75rem;padding:7px 10px;border-bottom:1px solid #eef0f8;text-align:center;">${(s.basePay||0).toLocaleString()} ${isEn?'EGP':'Ø¬'}</td>
        <td style="color:#7c3aed;font-weight:700;font-size:.75rem;padding:7px 10px;border-bottom:1px solid #eef0f8;text-align:center;">${(s.extraPay||0).toLocaleString()} ${isEn?'EGP':'Ø¬'}</td>
        <td style="color:#1a7a3e;font-weight:800;font-size:.78rem;padding:7px 10px;border-bottom:1px solid #eef0f8;text-align:center;">${(s.total||0).toLocaleString()} ${isEn?'EGP':'Ø¬'}</td>
      </tr>`;
    }).join('');

    placesHTML+=`
    <div style="margin-bottom:16px;border-radius:12px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.1);border:1px solid ${color}33;">
      <!-- Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…ÙƒØ§Ù† -->
      <div style="background:linear-gradient(135deg,${color},${color}cc);color:#fff;padding:10px 14px;display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-size:.92rem;font-weight:900;">ğŸ¥ ${d.name}</div>
          <div style="font-size:.7rem;opacity:.85;margin-top:2px;">${d.shifts.length} ${isEn?'shifts':'Ø´ÙŠÙØª'} &nbsp;|&nbsp; ${period}</div>
        </div>
        <div style="text-align:${isEn?'right':'left'};">
          <div style="font-size:1rem;font-weight:900;">${d.total.toLocaleString()} ${isEn?'EGP':'Ø¬'}</div>
          <div style="font-size:.65rem;opacity:.8;">${isEn?'Gross':'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'}</div>
        </div>
      </div>
      <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
      <table style="width:100%;border-collapse:collapse;background:#fff;">
        <thead>
          <tr style="background:#f0f4ff;">
            <th style="padding:7px 10px;font-size:.68rem;font-weight:800;color:#555;text-align:${isEn?'left':'right'};border-bottom:2px solid ${color}44;">${isEn?'Date':'Ø§Ù„ØªØ§Ø±ÙŠØ®'}</th>
            <th style="padding:7px 10px;font-size:.68rem;font-weight:800;color:#555;text-align:${isEn?'left':'right'};border-bottom:2px solid ${color}44;">${isEn?'Details':'Ø§Ù„ØªÙØ§ØµÙŠÙ„'}</th>
            <th style="padding:7px 10px;font-size:.68rem;font-weight:800;color:#1a73e8;text-align:center;border-bottom:2px solid ${color}44;">${isEn?'Base':'Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ'}</th>
            <th style="padding:7px 10px;font-size:.68rem;font-weight:800;color:#7c3aed;text-align:center;border-bottom:2px solid ${color}44;">${isEn?'Extra':'Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ'}</th>
            <th style="padding:7px 10px;font-size:.68rem;font-weight:800;color:#1a7a3e;text-align:center;border-bottom:2px solid ${color}44;">${isEn?'Total':'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'}</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
        <tfoot>
          <tr style="background:#f8f0ff;">
            <td colspan="2" style="padding:8px 10px;font-size:.74rem;font-weight:700;color:#7c3aed;">
              ğŸ§¾ ${isEn?'Tax':'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©'}: ${st2}% &nbsp;â€”&nbsp; ${isEn?'Deduct:':'Ø®ØµÙ…:'} <span style="color:#c0392b;">${ta.toLocaleString()} ${isEn?'EGP':'Ø¬'}</span>
            </td>
            <td style="padding:8px 10px;font-size:.74rem;font-weight:800;color:#1a73e8;text-align:center;">${d.base.toLocaleString()} ${isEn?'EGP':'Ø¬'}</td>
            <td style="padding:8px 10px;font-size:.74rem;font-weight:800;color:#7c3aed;text-align:center;">${d.extra.toLocaleString()} ${isEn?'EGP':'Ø¬'}</td>
            <td style="padding:8px 10px;font-size:.82rem;font-weight:900;color:${color};text-align:center;">ğŸ’° ${isEn?'Net:':'ØµØ§ÙÙŠ:'} ${pn.toLocaleString()} ${isEn?'EGP':'Ø¬'}</td>
          </tr>
        </tfoot>
      </table>
    </div>`;
  });

  const html=`<!DOCTYPE html>
<html dir="${dir2}" lang="${currentLang}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SHIFTATY â€” ${isEn?'Salary Report':'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨'}</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
  @page{margin:8mm 10mm;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:Cairo,Arial,sans-serif;background:#f0f2f8;color:#1a1a2e;direction:${dir2};-webkit-print-color-adjust:exact;print-color-adjust:exact;}
  .page{max-width:820px;margin:0 auto;padding:16px;}

  /* â”€â”€ HEADER â”€â”€ */
  .rpt-hdr{
    background:linear-gradient(135deg,#1a1a2e 0%,#2d1b69 50%,#7c3aed 100%);
    color:#fff;padding:18px 22px;border-radius:14px;margin-bottom:12px;
    text-align:center;position:relative;overflow:hidden;
    -webkit-print-color-adjust:exact;print-color-adjust:exact;
  }
  .rpt-hdr::before{content:'';position:absolute;inset:0;
    background:linear-gradient(rgba(0,229,255,0.04) 1px,transparent 1px),
               linear-gradient(90deg,rgba(0,229,255,0.04) 1px,transparent 1px);
    background-size:28px 28px;}
  .rpt-hdr h1{font-size:1.8rem;font-weight:900;letter-spacing:5px;font-family:Arial Black,Arial;color:#00e5ff;
    text-shadow:0 0 15px rgba(0,229,255,0.4);position:relative;}
  .rpt-hdr .sub{font-size:.78rem;color:rgba(255,255,255,0.65);margin-top:5px;position:relative;}

  /* â”€â”€ STAT CARDS â”€â”€ */
  .sg{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px;}
  .sc{background:#fff;border-radius:12px;padding:12px 8px;text-align:center;
    box-shadow:0 2px 8px rgba(0,0,0,.08);border-top:3px solid;
    -webkit-print-color-adjust:exact;print-color-adjust:exact;}
  .sc .sv{font-size:1.3rem;font-weight:900;margin-bottom:3px;}
  .sc .sl{font-size:.65rem;color:#888;font-weight:600;}

  /* â”€â”€ NET CARD â”€â”€ */
  .nc{
    background:linear-gradient(135deg,#1a1a2e 0%,#7c3aed 100%);
    color:#fff;border-radius:14px;padding:16px 20px;text-align:center;margin-bottom:14px;
    -webkit-print-color-adjust:exact;print-color-adjust:exact;
  }
  .nc .nl{font-size:.76rem;opacity:.8;margin-bottom:6px;}
  .nc .nv{font-size:2.2rem;font-weight:900;color:#00e676;letter-spacing:1px;}
  .nc .nd{font-size:.73rem;opacity:.6;margin-top:5px;}

  @media print{
    body{background:#f0f2f8!important;}
    .rpt-hdr,.nc,.sc{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;}
    div[style*="background:linear-gradient"]{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;}
  }
</style>
</head>
<body>
<div class="page">

  <div class="rpt-hdr">
    <h1>âš¡ SHIFTATY</h1>
    <div class="sub">${isEn?'Salary Report':'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨'} &nbsp;â†&nbsp; ${isEn?'Earnings':'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'} &nbsp;â†&nbsp; ${isEn?'Summary':'Ø§Ù„Ù†Ù‡Ø§ÙŠØ©'}</div>
  </div>

  <div class="sg">
    <div class="sc" style="border-color:#1a73e8;">
      <div class="sv" style="color:#1a73e8;">${grossTotal.toLocaleString()} <span style="font-size:.9rem;">${isEn?'EGP':'Ø¬'}</span></div>
      <div class="sl">${isEn?'Grand Total':'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ'}</div>
    </div>
    <div class="sc" style="border-color:#7c3aed;">
      <div class="sv" style="color:#7c3aed;">${list.length}</div>
      <div class="sl">${isEn?'Total Shifts':'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ÙŠÙØªØ§Øª'}</div>
    </div>
    <div class="sc" style="border-color:#00897b;">
      <div class="sv" style="color:#00897b;">${Object.keys(byPlace).length}</div>
      <div class="sl">${isEn?'Workplaces':'Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„'}</div>
    </div>
  </div>

  <div class="nc">
    <div class="nl">ğŸ’° ${isEn?'Net Salary After Tax':'ØµØ§ÙÙŠ Ø§Ù„Ù…Ø±ØªØ¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©'} (${taxPct}%)</div>
    <div class="nv">${netTotal.toLocaleString()} ${isEn?'EGP':'Ø¬Ù†ÙŠÙ‡'}</div>
    ${taxAmt>0?`<div class="nd">${isEn?'Tax Deduction:':'Ø®ØµÙ… Ø¶Ø±ÙŠØ¨Ø©:'} ${taxAmt.toLocaleString()} ${isEn?'EGP':'Ø¬'}</div>`:''}
  </div>

  ${placesHTML}

</div>
${autoPrint?'<script>window.onload=function(){window.print();}<\/script>':''}
</body>
</html>`;

  const win=window.open('','_blank');
  if(!win){showToast('âš ï¸ Ø§ÙØªØ­ Ø§Ù„Ù€ popup ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­');return;}
  win.document.write(html);
  win.document.close();
}


// â”€â”€ LANGUAGE SYSTEM â”€â”€
let currentLang = localStorage.getItem('sj_lang') || 'ar';

const T = {
  ar: {
    subtitle: 'ØªØªØ¨Ø¹ Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„Ùƒ ÙˆØ£Ø±Ø¨Ø§Ø­Ùƒ ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†',
    nav_summary: 'Ø§Ù„Ù…Ù„Ø®Øµ', nav_log: 'Ø§Ù„Ø³Ø¬Ù„', nav_shift: 'Ø´ÙŠÙØª', nav_places: 'Ø§Ù„Ø£Ù…Ø§ÙƒÙ†',
    add_place: 'Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§Ù† Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯', place_name: 'Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†', pay_type: 'Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±',
    price: 'Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡)', add_place_btn: 'ğŸ¥ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙƒØ§Ù†',
    shift_title: 'ØªØ³Ø¬ÙŠÙ„ Ø´ÙŠÙØª Ø¬Ø¯ÙŠØ¯', select_place: 'Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„',
    date: 'Ø§Ù„ØªØ§Ø±ÙŠØ®', pay_per: 'Ø§Ù„Ø£Ø¬Ø± Ù„ÙƒÙ„', pay_price: 'Ø§Ù„Ø³Ø¹Ø±', count: 'Ø§Ù„Ø¹Ø¯Ø¯',
    extras: 'âš¡ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ', notes: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª', save_shift: 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø´ÙŠÙØª',
    summary: 'Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±ØªØ¨', print: '<span id="print-btn-lbl">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</span>', export_pdf: '<span id="export-pdf-lbl">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</span>',
    total: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ', tax: 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨', net: 'ğŸ’° Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„ÙƒÙ„ÙŠ',
    all_places: 'ÙƒÙ„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†', by_place: 'Ù„ÙƒÙ„ Ù…ÙƒØ§Ù†',
    no_shifts: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠÙØªØ§Øª Ù…Ø³Ø¬Ù„Ø©', shifts: 'Ø´ÙŠÙØª',
    lang_switch: 'English', lang_icon: 'ğŸŒ',
    hour: 'Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©', shift: 'Ø¨Ø§Ù„Ø´ÙŠÙØª', case: 'Ø¨Ø§Ù„Ø­Ø§Ù„Ø©',
    hours_extra: 'Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©', cases: 'Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ©', tech: 'ØªÙƒÙ†ÙŠÙƒ', other: 'Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰',
    add_extra: 'â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¥Ø¶Ø§ÙÙŠ',
    wa_btn: 'ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ±Ù‚ÙŠØ©', code_btn: 'ğŸ”‘ Ø¹Ù†Ø¯ÙŠ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„',
    share_btn: 'ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©', all_time: 'ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª',
    from_date: 'Ù…Ù† ØªØ§Ø±ÙŠØ®', to_date: 'Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®', month: 'Ø£Ùˆ Ø§Ø®ØªØ± Ø´Ù‡Ø±',
    gross: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', extra: 'Ø¥Ø¶Ø§ÙÙŠ', base: 'Ø£Ø³Ø§Ø³ÙŠ',
    report_title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨', total_shifts: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ÙŠÙØªØ§Øª',
    workplaces: 'Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„', grand_total: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ',
    net_salary: 'ØµØ§ÙÙŠ Ø§Ù„Ù…Ø±ØªØ¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©', tax_deduct: 'Ø®ØµÙ… Ø¶Ø±ÙŠØ¨Ø©',
    date_col: 'Ø§Ù„ØªØ§Ø±ÙŠØ®', details_col: 'Ø§Ù„ØªÙØ§ØµÙŠÙ„', base_col: 'Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',
    extra_col: 'Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ', total_col: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', tax_row: 'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©', net_col: 'ØµØ§ÙÙŠ',
    pound: 'Ø¬', period_start: 'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', period_end: 'Ø§Ù„Ù†Ù‡Ø§ÙŠØ©',
  },
  en: {
    subtitle: 'Track your work hours & earnings everywhere',
    nav_summary: 'Summary', nav_log: 'Log', nav_shift: 'Shift', nav_places: 'Places',
    add_place: 'Add New Workplace', place_name: 'Place Name', pay_type: 'Pay Type',
    price: 'Price (EGP)', add_place_btn: 'ğŸ¥ Add Place',
    shift_title: 'Log New Shift', select_place: 'Select Workplace',
    date: 'Date', pay_per: 'Pay Per', pay_price: 'Price', count: 'Count',
    extras: 'âš¡ Extras', notes: 'Notes', save_shift: 'ğŸ’¾ Save Shift',
    summary: 'Salary Summary', print: 'ğŸ–¨ï¸ Print', export_pdf: 'ğŸ“„ Export PDF',
    total: 'Gross Total', tax: 'Total Tax', net: 'ğŸ’° Net Total',
    all_places: 'All Places', by_place: 'Per Place',
    no_shifts: 'No shifts recorded', shifts: 'shifts',
    lang_switch: 'Ø¹Ø±Ø¨ÙŠ', lang_icon: 'ğŸŒ',
    hour: 'Per Hour', shift: 'Per Shift', case: 'Per Case',
    hours_extra: 'Extra Hours', cases: 'Regular Cases', tech: 'Technique', other: 'Other Cases',
    add_extra: 'â• Add Extra Item',
    wa_btn: 'ğŸ’¬ Contact on WhatsApp', code_btn: 'ğŸ”‘ I have an activation code',
    share_btn: 'ğŸ”— Share', all_time: 'All Time',
    from_date: 'From Date', to_date: 'To Date', month: 'Or select month',
    gross: 'Gross', extra: 'Extra', base: 'Base',
    report_title: 'Salary Report', total_shifts: 'Total Shifts',
    workplaces: 'Workplaces', grand_total: 'Grand Total',
    net_salary: 'Net Salary After Tax', tax_deduct: 'Tax Deduction',
    date_col: 'Date', details_col: 'Details', base_col: 'Base',
    extra_col: 'Extra', total_col: 'Total', tax_row: 'Tax', net_col: 'Net',
    pound: 'EGP', period_start: 'Start', period_end: 'End',
  }
};

function t(key){ return (T[currentLang] && T[currentLang][key]) || T['ar'][key] || key; }

function toggleLang(){
  currentLang = currentLang === 'ar' ? 'en' : 'ar';
  localStorage.setItem('sj_lang', currentLang);
  applyLang();
}

function applyLang(){
  const isEn = currentLang === 'en';
  const E = T.en, A = T.ar;

  document.getElementById('lang-label').textContent = isEn ? 'Ø¹Ø±Ø¨ÙŠ' : 'English';
  document.documentElement.dir = isEn ? 'ltr' : 'rtl';
  document.documentElement.lang = currentLang;

  // helper â€” set text if element exists
  const s = (id, val) => { const el=document.getElementById(id); if(el) el.textContent=val; };
  const v = (id, val) => { const el=document.getElementById(id); if(el) el.value=val; };  // for input values

  // â”€â”€ HEADER â”€â”€
  s('header-subtitle',         isEn ? E.subtitle        : A.subtitle);

  // â”€â”€ NAV â”€â”€
  s('nav-places-lbl',  isEn ? 'Places'   : 'Ø§Ù„Ø£Ù…Ø§ÙƒÙ†');
  s('nav-shift-lbl',   isEn ? 'Shift'    : 'Ø´ÙŠÙØª');
  s('nav-log-lbl',     isEn ? 'Log'      : 'Ø§Ù„Ø³Ø¬Ù„');
  s('nav-summary-lbl', isEn ? 'Summary'  : 'Ø§Ù„Ù…Ù„Ø®Øµ');

  // â”€â”€ PLACES PANEL â”€â”€
  s('add-place-title',    isEn ? 'ğŸ¥ Add New Workplace'       : 'ğŸ¥ Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§Ù† Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯');
  s('lbl-place-name',     isEn ? 'Place Name'                 : 'Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†');
  s('lbl-pay-type',       isEn ? 'Pay Type'                   : 'Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±');
  s('lbl-price',          isEn ? 'Price (EGP)'                : 'Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡)');
  s('add-place-btn-lbl',  isEn ? 'ğŸ¥ Add Place'               : 'ğŸ¥ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙƒØ§Ù†');
  s('places-sec-title',   isEn ? 'Registered Workplaces'      : 'Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©');
  s('no-places-lbl',      isEn ? 'No places added yet'        : 'Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ø£Ù…Ø§ÙƒÙ† Ø¨Ø¹Ø¯');

  // place type options
  const optHourP  = document.getElementById('opt-hour-p');
  const optShiftP = document.getElementById('opt-shift-p');
  const optCaseP  = document.getElementById('opt-case-p');
  if(optHourP)  optHourP.textContent  = isEn ? 'Per Hour'  : 'Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©';
  if(optShiftP) optShiftP.textContent = isEn ? 'Per Shift' : 'Ø¨Ø§Ù„Ø´ÙŠÙØª';
  if(optCaseP)  optCaseP.textContent  = isEn ? 'Per Case'  : 'Ø¨Ø§Ù„Ø­Ø§Ù„Ø©';

  // â”€â”€ LOG PANEL â”€â”€
  s('shift-form-title',    isEn ? 'â• New Shift'              : 'â• Ø´ÙŠÙØª Ø¬Ø¯ÙŠØ¯');
  s('lbl-workplace',       isEn ? 'Workplace'                 : 'Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„');
  s('lbl-date',            isEn ? 'Date'                      : 'Ø§Ù„ØªØ§Ø±ÙŠØ®');
  s('lbl-pay-type-section',isEn ? 'Pay Type & Rate'           : 'Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø± ÙˆØ§Ù„Ø³Ø¹Ø±');
  s('lbl-pay-per',         isEn ? 'Pay Type'                  : 'Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±');
  s('lbl-pay-price',       isEn ? 'Price'                     : 'Ø§Ù„Ø³Ø¹Ø±');
  s('l-count-lbl',         isEn ? 'Count'                     : 'Ø§Ù„Ø¹Ø¯Ø¯');
  s('extra-head-lbl',      isEn ? 'âš¡ Extras'                 : 'âš¡ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ');
  s('lbl-ex-label',        isEn ? 'Label'                     : 'Ø§Ù„ØªØ³Ù…ÙŠØ©');
  s('lbl-ex-count',        isEn ? 'Count'                     : 'Ø§Ù„Ø¹Ø¯Ø¯');
  s('lbl-ex-price',        isEn ? 'Price'                     : 'Ø§Ù„Ø³Ø¹Ø±');
  s('lbl-notes',           isEn ? 'Notes'                     : 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª');
  s('lbl-preview',         isEn ? 'Expected Total'            : 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹');
  s('save-shift-lbl',      isEn ? 'ğŸ’¾ Save Shift'             : 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø´ÙŠÙØª');
  s('add-extra-lbl',       isEn ? 'â• Add Extra Item'         : 'â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¥Ø¶Ø§ÙÙŠ');

  // default extra row name values (input values, not labels)
  const exHourName  = document.getElementById('l-ex-hour-name');
  const exCaseName  = document.getElementById('l-ex-case-name');
  const exTechName  = document.getElementById('l-ex-tech-name');
  const exOtherName = document.getElementById('l-ex-other-name');
  if(exHourName  && (exHourName.value==='Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©'||exHourName.value==='Extra Hours'))   exHourName.value  = isEn ? 'Extra Hours'    : 'Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©';
  if(exCaseName  && (exCaseName.value==='Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ©'||exCaseName.value==='Regular Cases'))   exCaseName.value  = isEn ? 'Regular Cases'  : 'Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¯ÙŠØ©';
  if(exTechName  && (exTechName.value==='ØªÙƒÙ†ÙŠÙƒ'||exTechName.value==='Technique'))             exTechName.value  = isEn ? 'Technique'      : 'ØªÙƒÙ†ÙŠÙƒ';
  if(exOtherName && (exOtherName.value==='Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰'||exOtherName.value==='Other Cases'))    exOtherName.value = isEn ? 'Other Cases'    : 'Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰';

  // pay type options in log form
  const optHourL  = document.getElementById('opt-hour-l');
  const optShiftL = document.getElementById('opt-shift-l');
  const optCaseL  = document.getElementById('opt-case-l');
  if(optHourL)  optHourL.textContent  = isEn ? 'Hour'  : 'Ø³Ø§Ø¹Ø©';
  if(optShiftL) optShiftL.textContent = isEn ? 'Shift' : 'Ø´ÙŠÙØª';
  if(optCaseL)  optCaseL.textContent  = isEn ? 'Case'  : 'Ø­Ø§Ù„Ø©';

  // l-no-place message
  const noPlaceEl = document.getElementById('l-no-place');
  if(noPlaceEl) noPlaceEl.textContent = isEn ? 'â¬†ï¸ Select a workplace first' : 'â¬†ï¸ Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† Ø¹Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹';

  // â”€â”€ SUMMARY PANEL â”€â”€
  s('lbl-report-title',  isEn ? 'Salary Report'          : 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨');
  s('lbl-from-date',     isEn ? 'ğŸ“… From Date'           : 'ğŸ“… Ù…Ù† ØªØ§Ø±ÙŠØ®');
  s('lbl-to-date',       isEn ? 'ğŸ“… To Date'             : 'ğŸ“… Ù„ØªØ§Ø±ÙŠØ®');
  s('lbl-or-month',      isEn ? 'ğŸ—“ï¸ Or select month'    : 'ğŸ—“ï¸ Ø£Ùˆ Ø§Ø®ØªØ± Ø´Ù‡Ø±');
  s('all-time-lbl',      isEn ? 'All Time'               : 'ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª');
  s('lbl-st-shifts',     isEn ? 'Shifts'                 : 'Ø´ÙŠÙØªØ§Øª');
  s('lbl-st-hours',      isEn ? 'Hours'                  : 'Ø³Ø§Ø¹Ø§Øª');
  s('lbl-st-cases',      isEn ? 'Cases'                  : 'Ø­Ø§Ù„Ø§Øª');
  s('lbl-vt-total',      isEn ? 'Total'                  : 'Ø§Ù„ÙƒÙ„ÙŠ');
  s('lbl-vt-byplace',    isEn ? 'Per Place'              : 'Ù„ÙƒÙ„ Ù…ÙƒØ§Ù†');
  s('lbl-tax-pct',       isEn ? 'ğŸ§¾ Tax Rate'            : 'ğŸ§¾ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©');
  s('lbl-net-salary',    isEn ? 'Net Salary'             : 'ØµØ§ÙÙŠ Ø§Ù„Ù…Ø±ØªØ¨');
  s('lbl-currency',      isEn ? 'Egyptian Pound'         : 'Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ');
  s('lbl-base-pay',      isEn ? 'ğŸ¥ Base Pay'            : 'ğŸ¥ Ø£Ø¬Ø± Ø£Ø³Ø§Ø³ÙŠ');
  s('lbl-extra-pay',     isEn ? 'âš¡ Extra'               : 'âš¡ Ø¥Ø¶Ø§ÙÙŠ');
  s('lbl-gross',         isEn ? 'ğŸ“Š Gross Total'         : 'ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ');
  s('lbl-net-row',       isEn ? 'ğŸ’° Net'                 : 'ğŸ’° Ø§Ù„ØµØ§ÙÙŠ');
  s('lbl-bp-filter',     isEn ? 'ğŸ“… Filter Per Place'    : 'ğŸ“… ÙÙ„ØªØ± Ù„ÙƒÙ„ Ù…ÙƒØ§Ù† Ø¹Ù„Ù‰ Ø­Ø¯Ù‡');
  s('lbl-bp-from',       isEn ? 'From Date'              : 'Ù…Ù† ØªØ§Ø±ÙŠØ®');
  s('lbl-bp-to',         isEn ? 'To Date'                : 'Ù„ØªØ§Ø±ÙŠØ®');
  s('lbl-bp-alltime',    isEn ? 'All Time'               : 'ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª');
  s('lbl-bp-gross',      isEn ? 'ğŸ“Š Grand Total'         : 'ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ');
  s('lbl-bp-tax',        isEn ? 'ğŸ§¾ Total Tax'           : 'ğŸ§¾ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨');
  s('lbl-bp-net',        isEn ? 'ğŸ’° Net Total'           : 'ğŸ’° Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„ÙƒÙ„ÙŠ');

  // tax row label (has inner span so handle separately)
  const taxRowEl = document.getElementById('lbl-tax-row');
  if(taxRowEl){
    const taxPctVal = document.getElementById('tax-pct-lbl')?.textContent || '0';
    taxRowEl.innerHTML = isEn
      ? `ğŸ§¾ Tax (<span id="tax-pct-lbl">${taxPctVal}</span>%)`
      : `ğŸ§¾ Ø¶Ø±ÙŠØ¨Ø© (<span id="tax-pct-lbl">${taxPctVal}</span>%)`;
  }

  // â”€â”€ PRINT / PDF BUTTONS â”€â”€
  s('print-btn-lbl',   isEn ? 'ğŸ–¨ï¸ Print'      : 'ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©');
  s('export-pdf-lbl',  isEn ? 'ğŸ“„ Export PDF'  : 'ğŸ“„ ØªØµØ¯ÙŠØ± PDF');

  // â”€â”€ SHIFTS PANEL filter placeholder â”€â”€
  const fPlaceEl = document.getElementById('f-place');
  if(fPlaceEl && fPlaceEl.options[0]) fPlaceEl.options[0].textContent = isEn ? 'All Places' : 'ÙƒÙ„ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†';

  // â”€â”€ SHARE BUTTON â”€â”€
  s('share-btn-lbl', isEn ? 'ğŸ”— Share' : 'ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©');

  // â”€â”€ summary-title-lbl (if exists) â”€â”€
  s('summary-title-lbl', isEn ? 'Salary Summary' : 'Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±ØªØ¨');

  s('wa-btn-lbl',    isEn ? 'ğŸ’¬ Contact on WhatsApp'      : 'ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ±Ù‚ÙŠØ©');
  s('code-btn-lbl',  isEn ? 'ğŸ”‘ I have an activation code' : 'ğŸ”‘ Ø¹Ù†Ø¯ÙŠ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„');

  // â”€â”€ PLACEHOLDERS â”€â”€
  const pName = document.getElementById('p-name');
  if(pName) pName.placeholder = isEn ? 'e.g. City Hospital' : 'Ù…Ø«Ø§Ù„: Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù†ÙˆØ±';

  // re-render dynamic content so tags inside show correct language
  renderShifts();
  renderPlaces();
  renderByPlace();
}

// â”€â”€ HELPERS â”€â”€
function fmtDate(d){if(!d)return'';const p=d.split('-');return`${p[2]}/${p[1]}/${p[0]}`;}
function showToast(msg){
  const t=document.createElement('div');t.textContent=msg;
  t.style.cssText=`position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#7c3aed,#00e5ff);color:#fff;padding:12px 22px;border-radius:50px;font-family:Cairo,sans-serif;font-weight:700;font-size:.85rem;z-index:9999;box-shadow:0 6px 25px rgba(0,229,255,0.35);white-space:nowrap;max-width:90vw;text-align:center;`;
  document.body.appendChild(t);setTimeout(()=>t.remove(),2500);
}

// â”€â”€ INIT â”€â”€
document.addEventListener('DOMContentLoaded',()=>{
  // Ù„Ùˆ ÙÙŠ ?reset ÙÙŠ Ø§Ù„Ù€ URL â€” Ø§Ù…Ø³Ø­ ÙƒÙ„ Ø­Ø§Ø¬Ø© ÙˆØ§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„
  if(window.location.search.includes('reset')){
    localStorage.clear();
    window.location.href = window.location.pathname;
    return;
  }
  // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ù„Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØªØ«Ø¨Øª ÙØ¹Ù„Ø§Ù‹
  const isStandalone = window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
  if(isStandalone){
    // Ù…ØªØ«Ø¨Øª â€” Ø§Ø®ÙÙŠ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ø³ Ø®Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
    ['install-android-btn','install-ios-btn','install-desktop-btn'].forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.style.display = 'none';
    });
  }
  // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ø®ÙÙŠ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ
  window.matchMedia('(display-mode: standalone)').addEventListener('change', (e) => {
    if(e.matches){
      ['install-android-btn','install-ios-btn','install-desktop-btn'].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.style.display = 'none';
      });
    }
  });
  document.getElementById('l-date').value=new Date().toISOString().split('T')[0];
  const now=new Date();
  const ym=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  document.getElementById('s-month').value=ym;
  document.getElementById('f-month').value=ym;
  renderPlaces();populateSels();

  // Header tap for admin â€” Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© "Ø³Ø¬Ù„" Ø¨Ø³
  // tap counter â€” click Ø¨Ø³ (touchend Ø¨ÙŠØ¹Ù…Ù„ double count)
  let _tapCount = 0, _tapTimer = null;
  document.getElementById('admin-trigger').addEventListener('click', function(e){
    e.preventDefault();
    _tapCount++;
    if(_tapTimer) clearTimeout(_tapTimer);
    _tapTimer = setTimeout(function(){ _tapCount = 0; }, 3000);
    if(_tapCount >= 10){
      _tapCount = 0;
      clearTimeout(_tapTimer);
      const pass = prompt('ğŸ” Ø£Ø¯Ø®Ù„ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…:');
      if(pass === ADMIN_PASS){ openAdmin(); }
      else if(pass !== null){ showToast('âŒ Ø¨Ø§Ø³ÙˆØ±Ø¯ ØºÙ„Ø·'); }
    }
  });

  // Check activation on load
  checkActivation();
  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
  if(localStorage.getItem('sj_lang') === 'en') applyLang();

  // Register SW
  // Service Worker â€” ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙˆØ± Ø±ÙØ¹ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø©
  if('serviceWorker' in navigator){
    const CACHE_VERSION = 'v20260228200254';
    const swCode = `
      const CACHE = '${CACHE_VERSION}';
      const OFFLINE_ASSETS = ['./', './index.html', './manifest.json', './icon-192.png', './icon-512.png'];
      self.addEventListener('install', e => {
        e.waitUntil(
          caches.open(CACHE).then(c =>
            Promise.allSettled(OFFLINE_ASSETS.map(a => c.add(a).catch(()=>{})))
          ).then(() => self.skipWaiting())
        );
      });
      self.addEventListener('activate', e => {
        e.waitUntil(
          caches.keys().then(keys =>
            Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))
          ).then(() => self.clients.claim())
        );
      });
      self.addEventListener('fetch', e => {
        if(e.request.method !== 'GET') return;
        // Ù„Ù„Ù€ HTML: network-first Ø¹Ø´Ø§Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ØªÙˆØµÙ„ ÙÙˆØ±Ø§Ù‹
        // Ù„Ù„Ø¨Ø§Ù‚ÙŠ: cache-first Ø¹Ø´Ø§Ù† Ø§Ù„Ù€ offline ÙŠØ´ØªØºÙ„
        const isHTML = e.request.headers.get('accept')?.includes('text/html');
        e.respondWith(
          isHTML
            ? fetch(e.request).then(res => {
                if(res && res.status === 200) caches.open(CACHE).then(c => c.put(e.request, res.clone()));
                return res;
              }).catch(() => caches.match(e.request))
            : caches.match(e.request).then(cached => {
                const net = fetch(e.request).then(res => {
                  if(res && res.status === 200) caches.open(CACHE).then(c => c.put(e.request, res.clone()));
                  return res;
                }).catch(() => cached);
                return cached || net;
              })
        );
      });
    `.replace('\${CACHE_VERSION}', CACHE_VERSION);
    const blob = new Blob([swCode], {type: 'application/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl).then(reg => {
      // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 60 Ø«Ø§Ù†ÙŠØ©
      setInterval(() => reg.update(), 60000);
      reg.addEventListener('updatefound', () => {
        const newSW = reg.installing;
        newSW.addEventListener('statechange', () => {
          if(newSW.state === 'installed' && navigator.serviceWorker.controller){
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø³ Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ Ù…Ø´ØªØ±Ùƒ
            const activated = localStorage.getItem('sj_activated') === 'true';
            const freeMode  = localStorage.getItem('sj_freemode') === 'true';
            if(!activated && !freeMode){
              window.location.reload();
            } else {
              // Ø¥Ø´Ø¹Ø§Ø± Ù‡Ø§Ø¯Ø¦ Ø¨Ø¯Ù„ Ø§Ù„Ù€ reload
              console.log('ØªØ­Ø¯ÙŠØ« Ø¬Ø§Ù‡Ø² â€” Ø³ÙŠÙØ·Ø¨Ù‚ Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØªØ­');
            }
          }
        });
      });
    }).catch(e => console.log('SW skipped'));
    
    // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø³ Ù„Ùˆ Ù…Ø´ Ù…Ø´ØªØ±Ùƒ
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      const activated = localStorage.getItem('sj_activated') === 'true';
      const freeMode  = localStorage.getItem('sj_freemode') === 'true';
      if(!activated && !freeMode) window.location.reload();
    });
  }
});
</script>
</body>
</html>
